<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>mattdancho.com</title>
  <link href="http://www.mattdancho.com/atom.xml" rel="self" />
  <link href="http://www.mattdancho.com/"/>
  <updated>2016-10-08T07:53:00-04:00</updated>
  <id>http://www.mattdancho.com</id>
  <author>
    <name>Matt Dancho</name>
    <email>mdancho@gmail.com</email>
  </author>
  
    <entry>
      <title>Customer Segmentation Part 3: Network Visualization</title>
      <link href="http://www.mattdancho.com/Business/2016/10/01/CustomerSegmentationPt3.html" />
      <updated>2016-10-01T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Business/2016/10/01/CustomerSegmentationPt3</id>
      <content type="html">&lt;p&gt;This post is the third and final part in the customer segmentation analysis. The &lt;a href=&quot;http://www.mattdancho.com/business/2016/08/07/CustomerSegmentationPt1.html&quot;&gt;first post&lt;/a&gt; focused on &lt;a href=&quot;https://en.wikipedia.org/wiki/K-means_clustering&quot;&gt;&lt;em&gt;K&lt;/em&gt;-Means Clustering&lt;/a&gt; to segment customers into distinct groups based on purchasing habits. The second post takes a different approach, using &lt;a href=&quot;https://en.wikipedia.org/wiki/Principal_component_analysis&quot;&gt;Pricipal Component Analysis (PCA)&lt;/a&gt; to visualize customer groups. The third and final post performs &lt;a href=&quot;https://en.wikipedia.org/wiki/Graph_drawing&quot;&gt;Network Visualization (Graph Drawing)&lt;/a&gt; using the &lt;code&gt;igraph&lt;/code&gt; and &lt;code&gt;networkD3&lt;/code&gt; libraries as a method to visualize the customer connections and relationship strengths.  &lt;/p&gt;

&lt;h2 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#network-vis&quot;&gt;Why Network Visualization?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#left-off&quot;&gt;Where We Left Off&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-ready&quot;&gt;Getting Ready for Network Visualization&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#get-data&quot;&gt;Getting the Data&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#read-data&quot;&gt;Reading the Data&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#manipulate-data&quot;&gt;Manipulating the Data&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#applying&quot;&gt;Developing the Network Visualization&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#cosine&quot;&gt;Step 1: Create a Cosine Similarity Matrix&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#prune&quot;&gt;Step 2: Prune the Tree&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#igraph&quot;&gt;Step 3: Create the igraph&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#visualizing-results&quot;&gt;Visualizing the Results with networkD3&lt;/a&gt; &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusions&quot;&gt;Conclusions&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#recap&quot;&gt;Recap&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#further-reading&quot;&gt;Further Reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;why-network-visualization-a-classanchor-idnetwork-visa&quot;&gt;Why Network Visualization? &lt;a class=&quot;anchor&quot; id=&quot;network-vis&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;According to &lt;a href=&quot;http://kateto.net/&quot;&gt;Katya Ognyanova&lt;/a&gt;, an expert in network theory, Network Visualization is a useful technique for viewing relationships in the data, with the key benefits being identification of the following:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/network_visualization_goals.png&quot; alt=&quot;Network Visualization Goals&quot; /&gt;&lt;/p&gt;

&lt;p class=&quot;text-center date&quot;&gt;Source: &lt;a href=&quot;http://kateto.net/network-visualization&quot;&gt;Network Visualization with R&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For customer segmentation, we can utilize network visualization to understand both the network communities and the strength of the relationships. Before we jump into network visualization, it’s a good idea to review where we left off in the previous customer segmentation posts.&lt;/p&gt;

&lt;h2 id=&quot;where-we-left-off-a-classanchor-idleft-offa&quot;&gt;Where We Left Off &lt;a class=&quot;anchor&quot; id=&quot;left-off&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;In the &lt;a href=&quot;http://www.mattdancho.com/business/2016/08/07/CustomerSegmentationPt1.html&quot;&gt;first post&lt;/a&gt;, we used &lt;em&gt;k&lt;/em&gt;-means clustering to analyze the &lt;code&gt;bikes data set&lt;/code&gt;, a collection of excel files that contains data for bike shops (customers), bikes (products), and sales orders for the bike manufacturer, &lt;a href=&quot;http://www.cannondale.com/&quot;&gt;&lt;em&gt;Cannondale&lt;/em&gt;&lt;/a&gt;. The bike shops and sales orders are fictional / simulated (see the &lt;a href=&quot;http://www.mattdancho.com/business/2016/07/12/orderSimulatoR.html&quot;&gt;orderSimulatoR post&lt;/a&gt; for more on this), but the bikes (products) are actual models from &lt;em&gt;Cannondale’s&lt;/em&gt; website. &lt;/p&gt;

&lt;p&gt;A hypothesis was formed that bike shops purchase bikes based on bike features such as unit price (high end vs affordable), primary category (Mountain vs Road), frame (aluminum vs carbon), etc. The sales orders were combined with the customer and product information and grouped to form a matrix of sales by model and customer. The &lt;code&gt;kmeans()&lt;/code&gt; function was run on a range of potential clusters, &lt;em&gt;k&lt;/em&gt;, and the &lt;code&gt;silhouette()&lt;/code&gt; function from the &lt;code&gt;cluster&lt;/code&gt; package was used to determine the optimal number of clusters.&lt;/p&gt;

&lt;p&gt;In the &lt;a href=&quot;http://www.mattdancho.com/business/2016/09/04/CustomerSegmentationPt2.html&quot;&gt;second post&lt;/a&gt;, we used PCA to visually examine the customer segments using the &lt;code&gt;prcomp()&lt;/code&gt; function in base &lt;code&gt;R&lt;/code&gt;. PCA visualization allowed us to identify a customer segment that k-means failed to pick up. &lt;/p&gt;

&lt;h2 id=&quot;getting-ready-for-network-visualization-a-classanchor-idgetting-readya&quot;&gt;Getting Ready for Network Visualization &lt;a class=&quot;anchor&quot; id=&quot;getting-ready&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;For those that would like to follow along, rather than run through the previous posts the sections below can be used to get everything ready for network visualization.&lt;/p&gt;

&lt;h4 id=&quot;getting-the-data-a-classanchor-idget-dataa&quot;&gt;Getting the Data &lt;a class=&quot;anchor&quot; id=&quot;get-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;You can access the data &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR/tree/master/data&quot;&gt;here&lt;/a&gt; if you would like to follow along. You’ll need to download the following files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;orders.xlsx&lt;/strong&gt;: Contains the fictional sales orders for &lt;em&gt;Cannondale&lt;/em&gt;. &lt;code&gt;customer.id&lt;/code&gt; in the &lt;strong&gt;orders.xlsx&lt;/strong&gt; file relates to &lt;code&gt;bike shop.id&lt;/code&gt; in the &lt;strong&gt;bikeshops.xlsx&lt;/strong&gt; file, and &lt;code&gt;product.id&lt;/code&gt; in the &lt;strong&gt;orders.xlsx&lt;/strong&gt; file relates to &lt;code&gt;bike.id&lt;/code&gt; in the &lt;strong&gt;bikes.xlsx&lt;/strong&gt; file.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;bikes.xlsx&lt;/strong&gt;:  Contains information on products (e.g. bike model, primary category, secondary category, unit price, etc). &lt;code&gt;bike.id&lt;/code&gt; is the primary key.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;bikeshops.xlsx&lt;/strong&gt;: Contains information on customers (e.g. customer name and location). &lt;code&gt;bikeshop.id&lt;/code&gt; is the primary key. &lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The script to load and configure the data into a customer trends matrix is shown below. &lt;/p&gt;

&lt;h4 id=&quot;reading-the-data-a-classanchor-idread-dataa&quot;&gt;Reading the Data &lt;a class=&quot;anchor&quot; id=&quot;read-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;This script will read the data. Make sure you have the excel files in a folder named “data” in your current working directory prior to running the script below.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Read Cannondale orders data --------------------------------------------------
library(xlsx)   # Used to read bikes data set
customers &amp;lt;- read.xlsx2(&amp;quot;./data/bikeshops.xlsx&amp;quot;, sheetIndex = 1,
                       colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;,
                                      &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;numeric&amp;quot;))
products &amp;lt;- read.xlsx2(&amp;quot;./data/bikes.xlsx&amp;quot;, sheetIndex = 1,
                        colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;,
                                       &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;numeric&amp;quot;))
orders &amp;lt;- read.xlsx2(&amp;quot;./data/orders.xlsx&amp;quot;, sheetIndex = 1, colIndex = 2:7,
                     colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;numeric&amp;quot;, &amp;quot;Date&amp;quot;, &amp;quot;numeric&amp;quot;,
                                    &amp;quot;numeric&amp;quot;, &amp;quot;numeric&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;manipulating-the-data-a-classanchor-idmanipulate-dataa&quot;&gt;Manipulating the Data &lt;a class=&quot;anchor&quot; id=&quot;manipulate-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;The script below combines the &lt;code&gt;orders&lt;/code&gt;, &lt;code&gt;customers&lt;/code&gt; and &lt;code&gt;products&lt;/code&gt; data frames into &lt;code&gt;orders.extended&lt;/code&gt;, which is a data frame that simulates output we would get from an SQL query of a sales orders database / ERP system. The data is then manipulated to form &lt;code&gt;customerTrends&lt;/code&gt;, which has the data structured such that the rows contain products and the columns contain purchase quantity (as percentage of total) by customer. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 1: Combine orders, customers, and products data frames ------------------
library(dplyr)
orders.extended &amp;lt;- merge(orders, customers, by.x = &amp;quot;customer.id&amp;quot;, by.y=&amp;quot;bikeshop.id&amp;quot;)
orders.extended &amp;lt;- merge(orders.extended, products, by.x = &amp;quot;product.id&amp;quot;, by.y = &amp;quot;bike.id&amp;quot;)
orders.extended &amp;lt;- orders.extended %&amp;gt;%
  mutate(price.extended = price * quantity) %&amp;gt;%
  select(order.date, order.id, order.line, bikeshop.name, model,
         quantity, price, price.extended, category1, category2, frame) %&amp;gt;%
  arrange(order.id, order.line)

# Step 2: Group by model &amp;amp; model features, summarize by quantity purchased -----
library(tidyr)  # For spread function
customerTrends &amp;lt;- orders.extended %&amp;gt;%
  group_by(bikeshop.name, model, category1, category2, frame, price) %&amp;gt;%
  summarise(total.qty = sum(quantity)) %&amp;gt;%
  spread(bikeshop.name, total.qty)
customerTrends[is.na(customerTrends)] &amp;lt;- 0  # Remove NA's

# Step 3: Convert price to binary high/low category ----------------------------
library(Hmisc)  # Needed for cut2 function
customerTrends$price &amp;lt;- cut2(customerTrends$price, g=2)

# Step 4: Convert customer purchase quantity to percentage of total quantity ---
customerTrends.mat &amp;lt;- as.matrix(customerTrends[,-(1:5)])  # Drop first five columns
customerTrends.mat &amp;lt;- prop.table(customerTrends.mat, margin = 2)  # column-wise pct
customerTrends &amp;lt;- bind_cols(customerTrends[,(1:5)], as.data.frame(customerTrends.mat))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Note that if the code above seems confusing, I recommend stepping through each step in the code chunk separately, then stopping to view the data frame that is created. the intention is to build the orders data frame and then convert it into a data frame that relates customers to the product purchase history.&lt;/p&gt;

&lt;p&gt;Here’s the first 6 rows of &lt;code&gt;customerTrends&lt;/code&gt;:&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;customerTrends %&amp;gt;% head() %&amp;gt;% knitr::kable() # First 6 rows&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Albuquerque Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ann Arbor Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Austin Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Cincinnati Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Columbus Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Dallas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Denver Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Detroit Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Indianapolis Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ithaca Mountain Climbers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Kansas City 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Las Vegas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Los Angeles Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Louisville Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Miami Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Minneapolis Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Nashville Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New Orleans Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New York Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Oklahoma City Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Philadelphia Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Phoenix Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Pittsburgh Mountain Machines&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Portland Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Providence Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Antonio Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Francisco Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Seattle Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Tampa 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Wichita Speed&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0174825&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0066445&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0128205&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0117340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062893&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0075949&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0184783&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129870&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0244898&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112755&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0159151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0194175&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059172&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040650&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0170940&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139070&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158730&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031348&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0110759&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158456&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112360&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0173410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0021739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0095238&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0190275&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0239852&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0149502&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182529&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0213608&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0251572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0140449&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086957&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0242424&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053050&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050761&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152108&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059524&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0138289&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0220126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0084270&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0076104&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097826&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086580&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0232558&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106101&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0155280&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0147601&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0107527&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0234375&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0291262&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0019724&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0034965&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033223&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0025381&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0169492&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0102848&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0032051&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0202312&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0043478&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0049383&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051948&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204082&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0162086&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0201863&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0322581&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD Disc Ultegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139860&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0265781&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0203252&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0153453&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0079365&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106598&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112179&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0157233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0278481&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210674&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0375723&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152174&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0103896&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0163265&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139752&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0098619&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;developing-the-network-visualization-a-classanchor-idapplyinga&quot;&gt;Developing the Network Visualization &lt;a class=&quot;anchor&quot; id=&quot;applying&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Going from the &lt;code&gt;customerTrends&lt;/code&gt; to a network visualization requires three main steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#cosine&quot;&gt;Create a Cosine Similarity Matrix&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#prune&quot;&gt;Prune the Tree&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#igraph&quot;&gt;Create the iGraph&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;step-1-create-a-cosine-similarity-matrix-a-classanchor-idcosinea&quot;&gt;Step 1: Create a Cosine Similarity Matrix &lt;a class=&quot;anchor&quot; id=&quot;cosine&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The first step to network visualization is to get the data organized into a cosine similarity matrix. A similarity matrix is a way of numerically representing the similarity between multiple variables similar to a correlation matrix. We’ll use &lt;a href=&quot;https://en.wikipedia.org/wiki/Cosine_similarity&quot;&gt;Cosine Similarity&lt;/a&gt; to measure the relationship, which measures how similar the direction of a vector is to another vector. If that seems complicated, just think of a &lt;em&gt;customer cosine similarity&lt;/em&gt; as a number that reflects how closely the &lt;em&gt;direction of buying habits are related&lt;/em&gt;. Numbers will range from zero to one with numbers closer to one indicating very similar buying habits and numbers closer to zero indicating dissimilar buying habits. &lt;/p&gt;

&lt;p&gt;Implementing the cosine similarity matrix is quite easy since we already have our &lt;code&gt;customerTrends&lt;/code&gt; data frame organized relating customers (columns) to product purchases (rows). We’ll use the &lt;code&gt;cosine()&lt;/code&gt; function from the &lt;code&gt;lsa&lt;/code&gt; library, and this will calculate all of the cosine similarities for the entire matrix of &lt;code&gt;customerTrends.mat&lt;/code&gt;. Make sure to use the &lt;code&gt;matrix&lt;/code&gt; version of customer trends (&lt;code&gt;customerTrends.mat&lt;/code&gt;) because the data frame version needs to be vectorized to work with the &lt;code&gt;cosine()&lt;/code&gt; function. Also, set the diagonal of the matrix to zero since showing a customer perfectly related to itself is of no significance (and it will mess up the network visualization).&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Create adjacency matrix using cosine similarity ------------------------------
library(lsa) # for cosine similarity matrix
simMatrix &amp;lt;- cosine(customerTrends.mat)
diag(simMatrix) &amp;lt;- 0 # Remove relationship with self
simMatrix %&amp;gt;% head() %&amp;gt;% knitr::kable() # Show first 6 rows&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Albuquerque Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ann Arbor Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Austin Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Cincinnati Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Columbus Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Dallas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Denver Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Detroit Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Indianapolis Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ithaca Mountain Climbers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Kansas City 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Las Vegas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Los Angeles Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Louisville Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Miami Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Minneapolis Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Nashville Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New Orleans Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New York Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Oklahoma City Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Philadelphia Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Phoenix Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Pittsburgh Mountain Machines&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Portland Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Providence Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Antonio Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Francisco Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Seattle Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Tampa 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Wichita Speed&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Albuquerque Cycles&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6196043&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5949773&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5441725&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5820150&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6530917&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6884538&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7002334&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5978768&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5078464&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7093675&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5446492&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6380272&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5594956&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6547042&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7004260&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6518819&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6777294&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6960022&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6363207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5707993&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7305334&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5140454&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7071841&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7215378&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5516854&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5133781&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5742002&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4473463&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5262326&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ann Arbor Speed&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6196043&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7431950&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7192722&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6592156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6620349&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6040483&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7386500&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7564289&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4220565&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6025264&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6672118&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6457366&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6989536&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8870122&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7440162&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8124362&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8508068&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7319914&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8752170&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6297372&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7734097&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3701049&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7219594&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7822326&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6049646&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6840396&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7040305&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2977984&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6616981&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Austin Cruisers&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5949773&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7431950&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5940164&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5669442&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6149962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6321736&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6400633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7529293&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3600130&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5998858&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5346083&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6918423&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5288644&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7774333&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7369872&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7537841&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8092385&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7083957&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8238060&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7173744&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7717719&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.3508169&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7462988&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6738986&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6677525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6277214&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6765133&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.2963872&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5753771&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cincinnati Speed&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5441725&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7192722&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5940164&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7958886&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5358366&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4906622&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5881155&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5840801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6148244&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4859399&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8190995&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5220178&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8582985&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6653056&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6326827&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6734630&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7217393&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6057358&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7144663&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5328109&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6150989&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5884739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5836405&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5920849&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5422443&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8296494&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6401309&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4714808&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.8075219&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Columbus Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5820150&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6592156&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5669442&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7958886&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5185814&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5309790&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7042962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5234586&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6141313&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5104736&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7938090&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5372245&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7807134&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6335681&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6013218&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6266589&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6613703&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5650758&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6378461&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5721180&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6128332&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5935363&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5948224&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5692300&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5193049&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7784591&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6046323&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4425796&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7480177&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Dallas Cycles&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6530917&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6620349&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6149962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5358366&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5185814&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7431264&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7496033&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6082637&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4708646&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7468975&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4700985&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6821557&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4854827&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6675449&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7803219&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6766304&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7056240&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6769829&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6776227&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6251085&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7680813&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4075283&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7546924&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.7567971&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.6388616&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4739439&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.5715158&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4358491&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.4436880&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;step-2-prune-the-tree-a-classanchor-idprunea&quot;&gt;Step 2: Prune the Tree &lt;a class=&quot;anchor&quot; id=&quot;prune&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;It’s a good idea to prune the tree before we move to graphing. The network graphs can become quite messy if we do not limit the number of edges. We do this by reviewing the cosine similarity matrix and selecting an &lt;code&gt;edgeLimit&lt;/code&gt;, a number below which the cosine similarities will be replaced with zero. This keeps the highest ranking relationships while reducing the noise. We select 0.70 as the limit, but typically this is a trial and error process. If the limit is too high, the network graph will not show enough detail. Try testing different edge limits to see what looks best in Step 3.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Prune edges of the tree
edgeLimit &amp;lt;- .70
simMatrix[(simMatrix &amp;lt; edgeLimit)] &amp;lt;- 0&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;step-3-create-the-igraph-a-classanchor-idigrapha&quot;&gt;Step 3: Create the iGraph &lt;a class=&quot;anchor&quot; id=&quot;igraph&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Creating the &lt;code&gt;igraph&lt;/code&gt; is easy with the &lt;code&gt;graph_from_adjacency_matrix()&lt;/code&gt; function. Just pass the pruned &lt;code&gt;simMatrix&lt;/code&gt;. We can also get the communities by passing the &lt;code&gt;simMatrix&lt;/code&gt; to the &lt;code&gt;cluster_edge_betweenness()&lt;/code&gt; function. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;library(igraph)
simIgraph &amp;lt;- graph_from_adjacency_matrix(simMatrix, 
                                         mode = 'undirected', 
                                         weighted = T)
ceb &amp;lt;- cluster_edge_betweenness(simIgraph) # For community detection&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Let’s pause to take a look as the cluster edge betweenness (&lt;code&gt;ceb&lt;/code&gt;). We can view a plot of the clusters by passing &lt;code&gt;ceb&lt;/code&gt; to the &lt;code&gt;dendPlot()&lt;/code&gt; function. Set the &lt;code&gt;mode&lt;/code&gt; to “hclust” to view as a hierarchical clustered dendrogram (it uses &lt;code&gt;hclust&lt;/code&gt; from the &lt;code&gt;stats&lt;/code&gt; library). We can see that the cluster edge betweenness has detected three distinct clusters.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;dendPlot(ceb, mode=&amp;quot;hclust&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-10-1-CustomerSegmentationPt3/unnamed-chunk-7-1.png&quot; alt=&quot;plot of chunk unnamed-chunk-7&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now we can plot the network graph by passing &lt;code&gt;ceb&lt;/code&gt; and &lt;code&gt;simIgraph&lt;/code&gt; to the &lt;code&gt;plot()&lt;/code&gt; function. See &lt;code&gt;plot.igraph&lt;/code&gt; for additional documentation.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;plot(x=ceb, y=simIgraph)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-10-1-CustomerSegmentationPt3/unnamed-chunk-8-1.png&quot; alt=&quot;plot of chunk unnamed-chunk-8&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Yikes. This is a little difficult to read. With that said, the graph did a nice job of showing the major customer segments. Also notice how the color of the node clusters match the dendrogram groupings. For readability sake, we’ll take a look at what the &lt;code&gt;networkD3&lt;/code&gt; package has to offer.&lt;/p&gt;

&lt;h2 id=&quot;visualizing-the-results-with-networkd3-a-classanchor-idvisualizing-resultsa&quot;&gt;Visualizing the Results with NetworkD3 &lt;a class=&quot;anchor&quot; id=&quot;visualizing-results&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The &lt;code&gt;networkD3&lt;/code&gt; library enables D3 JavaScript network graphs from &lt;code&gt;R&lt;/code&gt;. It has an &lt;code&gt;igraph_to_networkD3()&lt;/code&gt; function that can be used to seamlessly convert an &lt;code&gt;igraph&lt;/code&gt; object to &lt;code&gt;network3D&lt;/code&gt;. The benefits to D3 are interactivity:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The names are hidden until the user hovers over the node, improving readability.&lt;/li&gt;
  &lt;li&gt;Nodes can be dragged to manipulate the network graph for easier viewing.&lt;/li&gt;
  &lt;li&gt;Zoom is enabled, allowing the user to zero-in on specific nodes to more easily see the edges and thus better understand relationships.&lt;/li&gt;
&lt;/ul&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Use igraph ceb to find membership
members &amp;lt;- membership(ceb)

# Convert to object suitable for networkD3
simIgraph_d3 &amp;lt;- igraph_to_networkD3(simIgraph, group = members)

# Create force directed network plot
forceNetwork(Links = simIgraph_d3$links, Nodes = simIgraph_d3$nodes, 
             Source = 'source', Target = 'target', 
             NodeID = 'name', Group = 'group', 
             fontSize = 16, fontFamily = 'Arial', linkDistance = 100,
             zoom = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;iframe src=&quot;/figure/source/2016-10-1-CustomerSegmentationPt3/fN_d3.html&quot; style=&quot;border: none; width: 100%; height: 550px&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;conclusion-a-classanchor-idconclusionsa&quot;&gt;Conclusion &lt;a class=&quot;anchor&quot; id=&quot;conclusions&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Network visualization is an excellent way to view and understand interrelationships between customers. Network graphs are particularly useful as the data scales, as they can be pruned and viewed interactively to zero-in on complex relationships. We’ve all heard the saying a picture is worth a thousand words. A network graph could be worth many more as customers go from 30 in our example to hundreds, thousands or even millions. &lt;/p&gt;

&lt;h2 id=&quot;recap-a-classanchor-idrecapa&quot;&gt;Recap &lt;a class=&quot;anchor&quot; id=&quot;recap&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;This post expanded on our customer segmentation methodology by adding network graphing to our tool set. We manipulated our sales order data to obtain a format that relates products to customer purchases. We created a cosine similarity matrix using the &lt;code&gt;cosine()&lt;/code&gt; function from the &lt;code&gt;lsa&lt;/code&gt; library, and we used this as the foundation for our network graph. We “pruned the tree” to remove edges with low significance. We used the &lt;code&gt;igraph&lt;/code&gt; library to create an igraph with communities shown. Finally, we converted the igraph to an interactive graph using the &lt;code&gt;networkD3&lt;/code&gt; package. Pretty impressive, and hopefully you see that it’s not that difficult with a basic knowledge of &lt;code&gt;R&lt;/code&gt; programming.&lt;/p&gt;

&lt;h2 id=&quot;further-reading-a-classanchor-idfurther-readinga&quot;&gt;Further Reading &lt;a class=&quot;anchor&quot; id=&quot;further-reading&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://kateto.net/network-visualization&quot;&gt;Network Visualization with R&lt;/a&gt;: This article is an excellent place to start for those that want to understand the details behind Network Visualization in R.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://cran.r-project.org/web/views/Cluster.html&quot;&gt;CRAN Task View: Cluster Analysis &amp;amp; Finite Mixture Models&lt;/a&gt;: While we did not specifically focus on clustering in this post, the CRAN task view covers a wide range of libraries and tools available for clustering that can be used in addition to those covered in the three part series.  &lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.wiley.com/WileyCDA/WileyTitle/productCd-111866146X.html&quot;&gt;Data Smart: Using Data Science to Transform Information into Insight&lt;/a&gt;: Chapter 5 uses a similar approach on customers that purchase wine deals based on different buying preferences. This is a great book for those that are more familiar with Excel than &lt;code&gt;R&lt;/code&gt; programming.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

</content>
      
      <category>R-Project</category>
      
      <category>R</category>
      
      <category>Customer Segmentation</category>
      
      <category>Community Detection</category>
      
      <category>igraph</category>
      
      <category>networkD3</category>
      
      <category>bikes data set</category>
      
      
      <category>Business</category>
      
    </entry>
  
    <entry>
      <title>Customer Segmentation Part 2: PCA for Segment Visualization</title>
      <link href="http://www.mattdancho.com/Business/2016/09/04/CustomerSegmentationPt2.html" />
      <updated>2016-09-04T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Business/2016/09/04/CustomerSegmentationPt2</id>
      <content type="html">&lt;p&gt;This post is the second part in the customer segmentation analysis. The &lt;a href=&quot;http://www.mattdancho.com/business/2016/08/07/CustomerSegmentationPt1.html&quot;&gt;first post&lt;/a&gt; focused on &lt;a href=&quot;https://en.wikipedia.org/wiki/K-means_clustering&quot;&gt;&lt;em&gt;k&lt;/em&gt;-means clustering&lt;/a&gt; in &lt;code&gt;R&lt;/code&gt; to segment customers into distinct groups based on purchasing habits. This post takes a different approach, using &lt;a href=&quot;https://en.wikipedia.org/wiki/Principal_component_analysis&quot;&gt;Pricipal Component Analysis&lt;/a&gt; (PCA) in &lt;code&gt;R&lt;/code&gt; as a tool to view customer groups. Because PCA attacks the problem from a different angle than &lt;em&gt;k&lt;/em&gt;-means, we can get different insights. We’ll compare both the &lt;em&gt;k&lt;/em&gt;-means results with the PCA visualization. Let’s see what happens when we apply PCA.  &lt;/p&gt;

&lt;h2 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#pca&quot;&gt;Why PCA?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#left-off&quot;&gt;Where We Left Off&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-ready&quot;&gt;Getting Ready for PCA&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#get-data&quot;&gt;Getting the Data&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#read-data&quot;&gt;Reading the Data&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#manipulate-data&quot;&gt;Manipulating the Data&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#kmeans&quot;&gt;K-Means Clustering&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#applying-pca&quot;&gt;Applying PCA&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#visualizing-results&quot;&gt;Visualizing the Results&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#plotting&quot;&gt;Plotting the PC’s&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pca-k4&quot;&gt;PCA Viz: K=4 K-Means Grouping&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#pca-k5&quot;&gt;PCA Viz: K=5 K-Means Grouping&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#visual-inspection&quot;&gt;PCA Viz: Visual Inspection Grouping&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#group2&quot;&gt;Group 2 Inspection&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#group4&quot;&gt;Group 4 Inspection&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusions&quot;&gt;Conclusions&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#recap&quot;&gt;Recap&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#further-reading&quot;&gt;Further Reading&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;why-pca-a-classanchor-idpcaa&quot;&gt;Why PCA? &lt;a class=&quot;anchor&quot; id=&quot;pca&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;PCA is a dimensionality reduction algorithm: PCA takes your data and decomposes it using transformations into principal components (PC). Each PC is selected in the orthogonal direction that maximizes the linear variance of the data. In essence, PCA is nothing more than an algorithm that takes numeric data in x, y, z coordinates and changes the coordinates to x’, y’, and z’ that maximize the linear variance. A great article on the background behind PCA is &lt;a href=&quot;http://setosa.io/ev/principal-component-analysis/&quot;&gt;Pricipal Component Analysis: Explained Visually&lt;/a&gt;. As the title suggests, the article has great visuals to explain the algorithm. &lt;/p&gt;

&lt;p&gt;How does this help in customer segmentation / community detection? Unlike &lt;em&gt;k&lt;/em&gt;-means, PCA is not a direct solution. What PCA helps with is visualizing the essence of a data set. Because PCA selects PC’s based on the maximum linear variance, we can use the first few PC’s to describe a vast majority of the data set without needing to compare and contrast every single feature. By using PC1 and PC2, we can then visualize in 2D and inspect for clusters. We can also combine the results with the &lt;em&gt;k&lt;/em&gt;-means groups to see what &lt;em&gt;k&lt;/em&gt;-means detected as compared to the clusters in the PCA visualization.&lt;/p&gt;

&lt;p&gt;Before we jump into PCA, it’s a good idea to review where we left off in the previous customer segmentation post.&lt;/p&gt;

&lt;h2 id=&quot;where-we-left-off-a-classanchor-idleft-offa&quot;&gt;Where We Left Off &lt;a class=&quot;anchor&quot; id=&quot;left-off&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;In the &lt;a href=&quot;http://www.mattdancho.com/business/2016/08/07/CustomerSegmentationPt1.html&quot;&gt;first post&lt;/a&gt;, we used &lt;em&gt;k&lt;/em&gt;-means clustering to analyze the &lt;code&gt;bikes data set&lt;/code&gt;, a collection of excel files that contains data for bike shops (customers), bikes (products), and sales orders for the bike manufacturer, &lt;a href=&quot;http://www.cannondale.com/&quot;&gt;&lt;em&gt;Cannondale&lt;/em&gt;&lt;/a&gt;. The bike shops and sales orders are fictional / simulated (see the &lt;a href=&quot;http://www.mattdancho.com/business/2016/07/12/orderSimulatoR.html&quot;&gt;orderSimulatoR post&lt;/a&gt; for more on this), but the bikes (products) are actual models from &lt;em&gt;Cannondale’s&lt;/em&gt; website. &lt;/p&gt;

&lt;p&gt;A hypothesis was formed that bike shops purchase bikes based on bike features such as unit price (high end vs affordable), primary category (Mountain vs Road), frame (aluminum vs carbon), etc. The sales orders were combined with the customer and product information and grouped to form a matrix of sales by model and customer. The &lt;code&gt;kmeans()&lt;/code&gt; function was run on a range of potential clusters, &lt;em&gt;k&lt;/em&gt;, and the &lt;code&gt;silhouette()&lt;/code&gt; function from the &lt;code&gt;cluster&lt;/code&gt; package was used to determine the optimal number of clusters.&lt;/p&gt;

&lt;h2 id=&quot;getting-ready-for-pca-a-classanchor-idgetting-readya&quot;&gt;Getting Ready for PCA &lt;a class=&quot;anchor&quot; id=&quot;getting-ready&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Rather than run through the previous post, the sections below can be used to get everthing ready for PCA.&lt;/p&gt;

&lt;h4 id=&quot;getting-the-data-a-classanchor-idget-dataa&quot;&gt;Getting the Data &lt;a class=&quot;anchor&quot; id=&quot;get-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;You can access the data &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR/tree/master/data&quot;&gt;here&lt;/a&gt; if you would like to follow along. You’ll need to download the following files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;orders.xlsx&lt;/strong&gt;: Contains the fictional sales orders for &lt;em&gt;Cannondale&lt;/em&gt;. &lt;code&gt;customer.id&lt;/code&gt; in the &lt;strong&gt;orders.xlsx&lt;/strong&gt; file relates to &lt;code&gt;bike shop.id&lt;/code&gt; in the &lt;strong&gt;bikeshops.xlsx&lt;/strong&gt; file, and &lt;code&gt;product.id&lt;/code&gt; in the &lt;strong&gt;orders.xlsx&lt;/strong&gt; file relates to &lt;code&gt;bike.id&lt;/code&gt; in the &lt;strong&gt;bikes.xlsx&lt;/strong&gt; file.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;bikes.xlsx&lt;/strong&gt;:  Contains information on products (e.g. bike model, primary category, secondary category, unit price, etc). &lt;code&gt;bike.id&lt;/code&gt; is the primary key.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;bikeshops.xlsx&lt;/strong&gt;: Contains information on customers (e.g. customer name and location). &lt;code&gt;bikeshop.id&lt;/code&gt; is the primary key. &lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The script to load and configure the data into a customer trends matrix is shown below. &lt;/p&gt;

&lt;h4 id=&quot;reading-the-data-a-classanchor-idread-dataa&quot;&gt;Reading the Data &lt;a class=&quot;anchor&quot; id=&quot;read-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;This script will read the data. Make sure you have the excel files in a folder named “data” in your current working directory prior to running the script below.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Read Cannondale orders data --------------------------------------------------
library(xlsx)   # Used to read bikes data set
customers &amp;lt;- read.xlsx2(&amp;quot;./data/bikeshops.xlsx&amp;quot;, sheetIndex = 1,
                       colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;,
                                      &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;numeric&amp;quot;))
products &amp;lt;- read.xlsx2(&amp;quot;./data/bikes.xlsx&amp;quot;, sheetIndex = 1,
                        colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;,
                                       &amp;quot;character&amp;quot;, &amp;quot;character&amp;quot;, &amp;quot;numeric&amp;quot;))
orders &amp;lt;- read.xlsx2(&amp;quot;./data/orders.xlsx&amp;quot;, sheetIndex = 1, colIndex = 2:7,
                     colClasses = c(&amp;quot;numeric&amp;quot;, &amp;quot;numeric&amp;quot;, &amp;quot;Date&amp;quot;, &amp;quot;numeric&amp;quot;,
                                    &amp;quot;numeric&amp;quot;, &amp;quot;numeric&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;manipulating-the-data-a-classanchor-idmanipulate-dataa&quot;&gt;Manipulating the Data &lt;a class=&quot;anchor&quot; id=&quot;manipulate-data&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;The script below combines the &lt;code&gt;orders&lt;/code&gt;, &lt;code&gt;customers&lt;/code&gt; and &lt;code&gt;products&lt;/code&gt; data frames into &lt;code&gt;orders.extended&lt;/code&gt;, which is a data frame that simulates output we would get from an SQL query of a sales orders database / ERP system. The data is then manipulated to form &lt;code&gt;customerTrends&lt;/code&gt;, which has the data structured such that the rows contain products and the columns contain purchase quantity (as percentage of total) by customer. The output, &lt;code&gt;customerTrends&lt;/code&gt;, is then used for &lt;em&gt;k&lt;/em&gt;-means clustering.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Combine orders, customers, and products data frames --------------------------
library(dplyr)
orders.extended &amp;lt;- merge(orders, customers, by.x = &amp;quot;customer.id&amp;quot;, by.y=&amp;quot;bikeshop.id&amp;quot;)
orders.extended &amp;lt;- merge(orders.extended, products, by.x = &amp;quot;product.id&amp;quot;, by.y = &amp;quot;bike.id&amp;quot;)
orders.extended &amp;lt;- orders.extended %&amp;gt;%
  mutate(price.extended = price * quantity) %&amp;gt;%
  select(order.date, order.id, order.line, bikeshop.name, model,
         quantity, price, price.extended, category1, category2, frame) %&amp;gt;%
  arrange(order.id, order.line)

# Group by model &amp;amp; model features, summarize by quantity purchased -------------
library(tidyr)  # For spread function
customerTrends &amp;lt;- orders.extended %&amp;gt;%
  group_by(bikeshop.name, model, category1, category2, frame, price) %&amp;gt;%
  summarise(total.qty = sum(quantity)) %&amp;gt;%
  spread(bikeshop.name, total.qty)
customerTrends[is.na(customerTrends)] &amp;lt;- 0  # Remove NA's

# Convert price to binary high/low category ------------------------------------
library(Hmisc)  # Needed for cut2 function
customerTrends$price &amp;lt;- cut2(customerTrends$price, g=2)

# Convert customer purchase quantity to percentage of total quantity -----------
customerTrends.mat &amp;lt;- as.matrix(customerTrends[,-(1:5)])  # Drop first five columns
customerTrends.mat &amp;lt;- prop.table(customerTrends.mat, margin = 2)  # column-wise pct
customerTrends &amp;lt;- bind_cols(customerTrends[,1:5], as.data.frame(customerTrends.mat))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Here’s the first 6 rows of &lt;code&gt;customerTrends&lt;/code&gt;:&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;knitr::kable(head(customerTrends))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Albuquerque Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ann Arbor Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Austin Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Cincinnati Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Columbus Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Dallas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Denver Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Detroit Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Indianapolis Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ithaca Mountain Climbers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Kansas City 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Las Vegas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Los Angeles Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Louisville Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Miami Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Minneapolis Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Nashville Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New Orleans Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New York Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Oklahoma City Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Philadelphia Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Phoenix Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Pittsburgh Mountain Machines&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Portland Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Providence Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Antonio Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Francisco Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Seattle Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Tampa 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Wichita Speed&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0174825&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0066445&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0128205&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0117340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062893&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0075949&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0184783&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129870&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0244898&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112755&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0159151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0194175&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059172&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040650&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0170940&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139070&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158730&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031348&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0110759&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158456&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112360&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0173410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0021739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0095238&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0190275&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0239852&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0149502&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182529&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0213608&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0251572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0140449&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086957&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0242424&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053050&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050761&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152108&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059524&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0138289&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0220126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0084270&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0076104&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097826&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086580&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0232558&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106101&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0155280&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0147601&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0107527&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0234375&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0291262&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0019724&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0034965&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033223&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0025381&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0169492&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0102848&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0032051&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0202312&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0043478&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0049383&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051948&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204082&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0162086&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0201863&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0322581&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD Disc Ultegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139860&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0265781&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0203252&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0153453&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0079365&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106598&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112179&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0157233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0278481&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210674&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0375723&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152174&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0103896&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0163265&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139752&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0098619&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;k-means-clustering-a-classanchor-idkmeansa&quot;&gt;K-Means Clustering &lt;a class=&quot;anchor&quot; id=&quot;kmeans&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;We used the &lt;code&gt;kmeans()&lt;/code&gt; function to perform &lt;em&gt;k&lt;/em&gt;-means clustering. The &lt;a href=&quot;(http://www.mattdancho.com/business/2016/08/07/CustomerSegmentationPt1.html)&quot;&gt;&lt;em&gt;k&lt;/em&gt;-means post&lt;/a&gt; goes into great detail on how to select the right number of clusters, which I skipped for brevity. We’ll use the groups for &lt;script type=&quot;math/tex&quot;&gt;k = 4&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;k = 5&lt;/script&gt; clusters with the PCA analysis. Five clusters was the theoretical best solution, and four clusters was the best solution upon inspection of the data.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# K-Means Clustering (used later) ----------------------------------------------
set.seed(11) # For reproducibility
km4.out &amp;lt;- kmeans(t(customerTrends[,-(1:5)]), centers = 4, nstart = 50)

set.seed(11) # For reproducibility
km5.out &amp;lt;- kmeans(t(customerTrends[,-(1:5)]), centers = 5, nstart = 50)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;applying-pca-a-classanchor-idapplying-pcaa&quot;&gt;Applying PCA &lt;a class=&quot;anchor&quot; id=&quot;applying-pca&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Now, back to our main focus: PCA. Applying PCA is very simple once the data is formatted. We use the &lt;code&gt;prcomp()&lt;/code&gt; function available in base &lt;code&gt;R&lt;/code&gt;. It’s strongly recommended to scale and center the data (for some reason this is not the default). Further reading on PCA in &lt;code&gt;R&lt;/code&gt; can be found &lt;a href=&quot;https://tgmstat.wordpress.com/2013/11/28/computing-and-visualizing-pca-in-r/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# PCA using prcomp() -----------------------------------------------------------
pca &amp;lt;- prcomp(t(customerTrends[,-(1:5)]), scale. = T, center = T) # Perform PCA&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Once PCA is performed, it’s a good idea to take a look at the &lt;strong&gt;variance explained&lt;/strong&gt;. As stated before, the goal of PCA is to reduce the dimensions of the data. PCA does this by transforming the data into dimensions that are orthogonal to the variation. The greater the variance explained, the more information that is summarized by the PC. The &lt;code&gt;prcomp()&lt;/code&gt; function returns this variance by PC. You can use &lt;code&gt;summary(pca)&lt;/code&gt; to get the variance explained. Let’s take a look at the first nine PC’s visually. &lt;/p&gt;

&lt;iframe src=&quot;/figure/source/2016-9-4-CustomerSegmentationPt2/plotly1.html&quot; style=&quot;border: none; width: 100%; height: 400px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;PC1 and PC2 combined explain 44% of the variance of the data, and there’s a steep drop-off between PC2 and PC3. This means that plotting PC’s 1 and 2 will give us a reasonably good understanding of the data, and adding more PC’s beyond PC2 will result in minimal improvement. Note that it won’t always happen that there is a significant drop-off after PC2, and if more PC’s explain variance we would need to evaluate them as well. &lt;/p&gt;

&lt;h2 id=&quot;visualizing-the-results-a-classanchor-idvisualizing-resultsa&quot;&gt;Visualizing the Results &lt;a class=&quot;anchor&quot; id=&quot;visualizing-results&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;We’ll plot PC1 and PC2, and we’ll color the clusters initially using the k-means groups previously created. To do this, we first need to get the &lt;code&gt;pca&lt;/code&gt; data into a data frame that combines the customers with the PC’s. Luckily, the &lt;code&gt;ggfortify&lt;/code&gt; package has a function called &lt;code&gt;fortify()&lt;/code&gt; to do just that. Once our data is fortified, we create two data frames with the k-means groups added to the end so we can group on them. We’ll use the &lt;em&gt;k&lt;/em&gt;-means group to color the PCA results so we can compare to &lt;em&gt;k&lt;/em&gt;-means and gain insights. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Manipulate data for PCA Analyis ----------------------------------------------
library(ggfortify) # For fortify()
pca.fortify &amp;lt;- fortify(pca) # fortify() gets pca into usable format

# Add group (short for color) column using k=4 and k=5 groups
pca4.dat &amp;lt;- cbind(pca.fortify, group=km4.out$cluster)
pca5.dat &amp;lt;- cbind(pca.fortify, group=km5.out$cluster)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;plotting-the-pcs-a-classanchor-idplottinga&quot;&gt;Plotting the PC’s &lt;a class=&quot;anchor&quot; id=&quot;plotting&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;The script below provides sample &lt;code&gt;ggplot&lt;/code&gt; scripts to create a general plot for PC1 and PC2. The script uses my favorite interactive plotting library, &lt;code&gt;plotly&lt;/code&gt;, to turn the &lt;code&gt;ggplot&lt;/code&gt; results into interactive plots. The scripts used for the next section follow the same general procedure, so I won’t show the code for brevity.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Plotting PC1 and PC2 using ggplot and plotly ---------------------------------
library(ggplot2)
library(plotly)
# Script for plotting k=4
gg2 &amp;lt;- ggplot(pca4.dat) +
  geom_point(aes(x=PC1, y=PC2, col=factor(group), text=rownames(pca4.dat)), size=2) +
  labs(title = &amp;quot;Visualizing K-Means Clusters Against First Two Principal Components&amp;quot;) +
  scale_color_brewer(name=&amp;quot;&amp;quot;, palette = &amp;quot;Set1&amp;quot;)
# Use plotly for inteactivity
plotly2 &amp;lt;- ggplotly(gg2, tooltip = c(&amp;quot;text&amp;quot;, &amp;quot;x&amp;quot;, &amp;quot;y&amp;quot;)) %&amp;gt;%
  layout(legend = list(x=.9, y=.99))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;pca-viz-k4-k-means-grouping-a-classanchor-idpca-k4a&quot;&gt;PCA Viz: K=4 K-Means Grouping &lt;a class=&quot;anchor&quot; id=&quot;pca-k4&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;The PCA segmentation shows some interesting results. It appears that there are five clusters as opposed to four. The &lt;script type=&quot;math/tex&quot;&gt;k = 4&lt;/script&gt; &lt;em&gt;k&lt;/em&gt;-means results would not pick this up, because we selected four clusters. Maybe your thinking that the silhouette analysis from the previous post indicated that we should pick &lt;script type=&quot;math/tex&quot;&gt;k = 5&lt;/script&gt;, so this is where we went wrong. Let’s see what happens with the five cluster &lt;em&gt;k&lt;/em&gt;-means.&lt;/p&gt;

&lt;iframe src=&quot;/figure/source/2016-9-4-CustomerSegmentationPt2/plotly2.html&quot; style=&quot;border: none; width: 100%; height: 550px&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;pca-viz-k5-k-means-grouping-a-classanchor-idpca-k5a&quot;&gt;PCA Viz: K=5 K-Means Grouping &lt;a class=&quot;anchor&quot; id=&quot;pca-k5&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;Well, that’s not what we thought was going to happen! It looks like Group 2 was incorrectly classified. From the &lt;em&gt;k&lt;/em&gt;-means post, this actually makes sense: We inspected the clusters, and Group 2 and 4 were very similar in their preferences for bikes in the low-end price range. We decided to combine these clusters by switching to &lt;script type=&quot;math/tex&quot;&gt;k = 4&lt;/script&gt; clusters. Next, we’ll look at clustering based on inspection of the PCA plot.&lt;/p&gt;

&lt;iframe src=&quot;/figure/source/2016-9-4-CustomerSegmentationPt2/plotly3.html&quot; style=&quot;border: none; width: 100%; height: 550px&quot;&gt;&lt;/iframe&gt;

&lt;h4 id=&quot;pca-viz-visual-inspection-grouping-a-classanchor-idvisual-inspectiona&quot;&gt;PCA Viz: Visual Inspection Grouping &lt;a class=&quot;anchor&quot; id=&quot;visual-inspection&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;From the PCA visualization, we can see there are two bike shops that do not belong to Group 4. Based on our visual inspection, we can modify the groups (column 128) by switching Group 2 (San Antonio Bike Shop &amp;amp; Philadelphia Bike Shop) with the incorrectly classified Group 4 shops (Denver Bike Shop &amp;amp; Kansas City 29ers). &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Switch Group 2 Bike Shops with misclassified Bike Shops in Group 4 -----------
pca.final.dat &amp;lt;- pca5.dat
pca.final.dat[rownames(pca.final.dat) %in% 
                c(&amp;quot;San Antonio Bike Shop&amp;quot;, &amp;quot;Philadelphia Bike Shop&amp;quot;), 128] &amp;lt;- 4
pca.final.dat[rownames(pca.final.dat) %in% 
                c(&amp;quot;Denver Bike Shop&amp;quot;, &amp;quot;Kansas City 29ers&amp;quot;), 128] &amp;lt;- 2&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;And, let’s visualize the results. &lt;/p&gt;

&lt;iframe src=&quot;/figure/source/2016-9-4-CustomerSegmentationPt2/plotly4.html&quot; style=&quot;border: none; width: 100%; height: 550px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Everything looks good, but we need to inspect the newly created Group 2’s preferences to make sure they should truly be a standalone customer segment. &lt;/p&gt;

&lt;h4 id=&quot;group-2-inspection-a-classanchor-idgroup2a&quot;&gt;Group 2 Inspection &lt;a class=&quot;anchor&quot; id=&quot;group2&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;The script below modifies the &lt;code&gt;customerTrends&lt;/code&gt; data frame to select only customer columns that are in the group we want to inspect. The script then takes the average of the customer’s percent of quantity purchased vs total quantity purchased (the values in the customer columns). The data frame is sorted by most frequently purchased so we can see the group’s central tendency. For Group 2, the central tendency is a preference for low-end mountain bikes.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Inspect Group 2 Preferences --------------------------------------------------
# Select only groups in group num and perform row-wise average of bike prefs
library(dplyr)
group.num &amp;lt;- 2 # Set group number
group.names &amp;lt;- rownames(pca.final.dat[pca.final.dat$group == group.num, ])
groupTrends &amp;lt;- customerTrends %&amp;gt;%
  select(model:price, match(group.names, names(.))) # Use match() to select column names
group.avg &amp;lt;- apply(groupTrends[6:ncol(groupTrends)], 1, mean) # Take average of values
groupTrends &amp;lt;- bind_cols(groupTrends, as_data_frame(group.avg)) %&amp;gt;%
  arrange(-group.avg) 

knitr::kable(head(groupTrends, 10)) # Top ten products by group avg. pct. purchased&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Denver Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Kansas City 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Catalyst 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0256410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0187266&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0221838&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0216076&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210168&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;F-Si Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0165146&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0247767&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0206456&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Scalpel 29 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0186875&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210314&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0198595&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Catalyst 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0199913&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0184385&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0192149&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;F-Si 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0175742&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0190000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152108&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0218957&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0185532&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204259&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0164218&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0184238&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0208605&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158456&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0183530&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182529&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182017&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;group-4-inspection-a-classanchor-idgroup4a&quot;&gt;Group 4 Inspection &lt;a class=&quot;anchor&quot; id=&quot;group4&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;Let’s compare to Group 4. Rerun the previous script changing &lt;code&gt;group.num&lt;/code&gt; from 2 to 4. We can see that Group 4’s preference is similar to Group 2 in that both groups prefer low-end/affordable bikes. However, Group 4’s top purchases contain a mixture of Mountain and Road, while Group 2’s top purchases are exclusively Mountain. It appears there is a difference!&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Albuquerque Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Dallas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Detroit Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Los Angeles Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Minneapolis Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New York Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Philadelphia Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Phoenix Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Portland Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Providence Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Antonio Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;F-Si 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0174825&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0256410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0471698&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0258752&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0246914&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0183228&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0186335&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0207476&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Slice Ultegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Triathalon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0085470&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0251572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0076104&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0049383&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0571429&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0133897&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0248447&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0537634&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204572&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD12 Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139860&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0085470&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0297619&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0157233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0136986&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0222222&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204082&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0176180&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0310559&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0185229&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Catalyst 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0314685&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0427350&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0178571&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0188679&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0024691&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0140944&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0186335&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0202952&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0161290&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0183502&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;F-Si Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0128205&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0238095&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0188679&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0271605&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0448980&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0183228&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139752&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0180436&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Synapse Carbon Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Endurance Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139860&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0170940&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0125786&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0304414&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0271605&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0285714&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0091614&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0170807&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0166052&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0107527&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0175775&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD8 Sora&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0213675&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0188679&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0273973&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0098765&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204369&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0217391&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0202952&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0165892&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Synapse Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Endurance Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0279720&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0213675&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0019841&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0121766&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0271605&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204082&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0155039&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0093168&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0163404&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD12 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0299145&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0277778&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0188679&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106545&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0098765&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0326531&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0084567&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0093168&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0018450&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0161692&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0085470&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0125786&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0060883&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0197531&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0285714&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119803&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0124224&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0239852&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0322581&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0157362&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;conclusion-a-classanchor-idconclusionsa&quot;&gt;Conclusion &lt;a class=&quot;anchor&quot; id=&quot;conclusions&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;PCA can be a valuable cross-check to &lt;em&gt;k&lt;/em&gt;-means for customer segmentation. While &lt;em&gt;k&lt;/em&gt;-means got us close to the true customer segments, visually evaluating the groups using PCA helped identify a different customer segment, one that the &lt;script type=&quot;math/tex&quot;&gt;k = 5&lt;/script&gt; &lt;em&gt;k&lt;/em&gt;-means solution did not pick up.  &lt;/p&gt;

&lt;h2 id=&quot;recap-a-classanchor-idrecapa&quot;&gt;Recap &lt;a class=&quot;anchor&quot; id=&quot;recap&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;This post expanded on our customer segmentation methodology by using &lt;strong&gt;PCA to visually examine the clusters&lt;/strong&gt;. We manipulated our sales order data to obtain a format that relates products to customer purchases. We used the &lt;code&gt;prcomp()&lt;/code&gt; function to perform PCA on our formatted data frame. We fortified the PCA output using the &lt;code&gt;fortify()&lt;/code&gt; function from the &lt;code&gt;ggfortify&lt;/code&gt; package, which enabled us to plot the PC’s by customer. We added the &lt;em&gt;k&lt;/em&gt;-means cluster groups to the fortified data frame for visual inspection of the &lt;em&gt;k&lt;/em&gt;-means clusters. We saw that differences can arise because &lt;em&gt;k&lt;/em&gt;-means programatically determines the clusters while PCA allows us to visually inspect the clusters. The end result was an improvement to the customer segmentation by attacking the community detection problem from two different angles and combining the results! &lt;/p&gt;

&lt;h2 id=&quot;further-reading-a-classanchor-idfurther-readinga&quot;&gt;Further Reading &lt;a class=&quot;anchor&quot; id=&quot;further-reading&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://setosa.io/ev/principal-component-analysis/&quot;&gt;Pricipal Component Analysis: Explained Visually&lt;/a&gt;: This article is an excellent place to start for those that are new to PCA or those that would like to understand the details.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://tgmstat.wordpress.com/2013/11/28/computing-and-visualizing-pca-in-r/&quot;&gt;Computing and Visualizing PCA in R&lt;/a&gt;: This is a great article that takes PCA to the next level in &lt;code&gt;R&lt;/code&gt; with biplots, predictions, and the caret package.  &lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

</content>
      
      <category>R-Project</category>
      
      <category>R</category>
      
      <category>Customer Segmentation</category>
      
      <category>Community Detection</category>
      
      <category>PCA</category>
      
      <category>prcomp</category>
      
      <category>bikes data set</category>
      
      
      <category>Business</category>
      
    </entry>
  
    <entry>
      <title>Customer Segmentation Part 1: K-Means Clustering</title>
      <link href="http://www.mattdancho.com/Business/2016/08/07/CustomerSegmentationPt1.html" />
      <updated>2016-08-07T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Business/2016/08/07/CustomerSegmentationPt1</id>
      <content type="html">&lt;p&gt;In this post, we’ll be using &lt;a href=&quot;https://en.wikipedia.org/wiki/K-means_clustering&quot;&gt;&lt;em&gt;k&lt;/em&gt;-means clustering&lt;/a&gt; in &lt;code&gt;R&lt;/code&gt; to segment customers into distinct groups based on purchasing habits. &lt;em&gt;k&lt;/em&gt;-means clustering is an unsupervised learning technique, which means we don’t need to have a target for clustering. All we need is to format the data in a way the algorithm can process, and we’ll let it determine the customer segments or clusters. This makes &lt;em&gt;k&lt;/em&gt;-means clustering great for exploratory analysis as well as a jumping-off point for more detailed analysis. We’ll walk through a relevant example using the Cannondale &lt;code&gt;bikes data set&lt;/code&gt; from the &lt;code&gt;orderSimulatoR&lt;/code&gt; project &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR&quot;&gt;GitHub repository&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#how-works&quot;&gt;How &lt;em&gt;k&lt;/em&gt;-Means Works&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-started&quot;&gt;Getting Started&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#hypothesis&quot;&gt;Developing a Hypothesis for Customer Trends&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#manipulating-data&quot;&gt;Manipulating the Data Frame&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#kmeans&quot;&gt;&lt;em&gt;k&lt;/em&gt;-Means Clustering&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#running-algorithm&quot;&gt;Running the &lt;em&gt;k&lt;/em&gt;-Means Algorithm&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#customer-segments&quot;&gt;Which Customers are in Each Segment?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#determine-prefs&quot;&gt;Determining the Preferences of the Customer Segments&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#review&quot;&gt;Reviewing Results&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#recap&quot;&gt;Recap&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#further-reading&quot;&gt;Further Reading&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#updates&quot;&gt;Updates&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;how-k-means-works-a-classanchor-idhow-worksa&quot;&gt;How K-Means Works &lt;a class=&quot;anchor&quot; id=&quot;how-works&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The &lt;em&gt;k&lt;/em&gt;-means clustering algorithm works by finding like groups based on Euclidean distance, a measure of distance or similarity. The practitioner selects &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; groups to cluster, and the algorithm finds the best centroids for the &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; groups. The practitioner can then use those groups to determine which factors group members relate. For customers, these would be their buying preferences. &lt;/p&gt;

&lt;h2 id=&quot;getting-started-a-classanchor-idgetting-starteda&quot;&gt;Getting Started &lt;a class=&quot;anchor&quot; id=&quot;getting-started&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;To start, we’ll get need some orders to evaluate. If you’d like to follow along, we will be using the &lt;code&gt;bikes data set&lt;/code&gt;, which can be retrieved &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR/tree/master/data&quot;&gt;here&lt;/a&gt;. We’ll load the data first using the  &lt;code&gt;xlsx&lt;/code&gt; package for reading Excel files.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Read Cannondale orders data --------------------------------------------------
library(xlsx) 
customers &amp;lt;- read.xlsx(&amp;quot;./data/bikeshops.xlsx&amp;quot;, sheetIndex = 1)
products &amp;lt;- read.xlsx(&amp;quot;./data/bikes.xlsx&amp;quot;, sheetIndex = 1) 
orders &amp;lt;- read.xlsx(&amp;quot;./data/orders.xlsx&amp;quot;, sheetIndex = 1)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we’ll get the data into a usable format, typical of an &lt;code&gt;SQL&lt;/code&gt; query from an &lt;a href=&quot;https://en.wikipedia.org/wiki/Enterprise_resource_planning&quot;&gt;ERP database&lt;/a&gt;. The following code merges the customers, products and orders data frames using the &lt;code&gt;dplyr&lt;/code&gt; package.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Combine orders, customers, and products data frames --------------------------
library(dplyr)
orders.extended &amp;lt;- merge(orders, customers, by.x = &amp;quot;customer.id&amp;quot;, by.y=&amp;quot;bikeshop.id&amp;quot;)
orders.extended &amp;lt;- merge(orders.extended, products, by.x = &amp;quot;product.id&amp;quot;, by.y = &amp;quot;bike.id&amp;quot;)

orders.extended &amp;lt;- orders.extended %&amp;gt;%
  mutate(price.extended = price * quantity) %&amp;gt;%
  select(order.date, order.id, order.line, bikeshop.name, model,
         quantity, price, price.extended, category1, category2, frame) %&amp;gt;%
  arrange(order.id, order.line)

knitr::kable(head(orders.extended)) # Preview the data&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;bikeshop.name&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;quantity&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;price.extended&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca Mountain Climbers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6070&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6070&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca Mountain Climbers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Kansas City 29ers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2770&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2770&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Kansas City 29ers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Team&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10660&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10660&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3200&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3200&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;developing-a-hypothesis-for-customer-trends-a-classanchor-idhypothesisa&quot;&gt;Developing a Hypothesis for Customer Trends &lt;a class=&quot;anchor&quot; id=&quot;hypothesis&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Developing a hypothesis is necessary as the hypothesis will guide our decisions on how to formulate the data in such a way to cluster customers. For the Cannondale orders, our hypothesis is that bike shops purchase Cannondale bike models based on features such as Mountain or Road Bikes and price tier (high/premium or low/affordable). Although we will use bike model to cluster on, the bike model features (e.g. price, category, etc) will be used for assessing the preferences of the customer clusters (more on this later). &lt;/p&gt;

&lt;p&gt;To start, we’ll need a unit of measure to cluster on. We can select quantity purchased or total value of purchases. We’ll select quantity purchased because total value can be skewed by the bike unit price. For example, a premium bike can be sold for 10X more than an affordable bike, which can mask the quantity buying habits.&lt;/p&gt;

&lt;h2 id=&quot;manipulating-the-data-frame-a-classanchor-idmanipulating-dataa&quot;&gt;Manipulating the Data Frame &lt;a class=&quot;anchor&quot; id=&quot;manipulating-data&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Next, we need a data manipulation plan of attack to implement clustering on our data. We’ll user our hypothesis to guide us. First, we’ll need to get the data frame into a format conducive to clustering bike models to customer id’s. Second, we’ll need to manipulate price into a categorical variables representing high/premium and low/affordable. Last, we’ll need to scale the bike model quantities purchased by customer so the &lt;em&gt;k&lt;/em&gt;-means algorithm weights the purchases of each customer evenly. &lt;/p&gt;

&lt;p&gt;We’ll tackle formatting the data frame for clustering first. We need to spread the customers by quantity of bike models purchased. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Group by model &amp;amp; model features, summarize by quantity purchased -------------
library(tidyr)  # Needed for spread function
customerTrends &amp;lt;- orders.extended %&amp;gt;%
        group_by(bikeshop.name, model, category1, category2, frame, price) %&amp;gt;%
        summarise(total.qty = sum(quantity)) %&amp;gt;%
        spread(bikeshop.name, total.qty)
customerTrends[is.na(customerTrends)] &amp;lt;- 0  # Remove NA's&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we need to convert the unit price to categorical high/low variables. One way to do this is with the &lt;code&gt;cut2()&lt;/code&gt; function from the &lt;code&gt;Hmisc&lt;/code&gt; package. We’ll segment the price into high/low by median price. Selecting &lt;code&gt;g&lt;/code&gt; = 2 divides the unit prices into two halves using the median as the split point. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Convert price to binary high/low category ------------------------------------
library(Hmisc)  # Needed for cut2 function
customerTrends$price &amp;lt;- cut2(customerTrends$price, g=2)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Last, we need to scale the quantity data. Unadjusted quantities presents a problem to the &lt;em&gt;k&lt;/em&gt;-means algorithm. Some customers are larger than others meaning they purchase higher volumes. Fortunately, we can resolve this issue by converting the customer order quantities to proportion of the total bikes purchased by a customer. The &lt;code&gt;prop.table()&lt;/code&gt; matrix function provides a convenient way to do this. An alternative is to use the &lt;code&gt;scale()&lt;/code&gt; function, which normalizes the data. However, this is less interpretable than the proportion format.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Convert customer purchase quantity to percentage of total quantity -----------
customerTrends.mat &amp;lt;- as.matrix(customerTrends[,-(1:5)])  # Drop first five columns
customerTrends.mat &amp;lt;- prop.table(customerTrends.mat, margin = 2)  # column-wise pct
customerTrends &amp;lt;- cbind(customerTrends[,1:5], as.data.frame(customerTrends.mat))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The final data frame (first five rows shown below) is now ready for clustering. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# View data post manipulation --------------------------------------------------
knitr::kable(head(customerTrends))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Albuquerque Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ann Arbor Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Austin Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Cincinnati Speed&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Columbus Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Dallas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Denver Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Detroit Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Indianapolis Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Ithaca Mountain Climbers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Kansas City 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Las Vegas Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Los Angeles Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Louisville Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Miami Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Minneapolis Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Nashville Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New Orleans Velocipedes&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;New York Cycles&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Oklahoma City Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Philadelphia Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Phoenix Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Pittsburgh Mountain Machines&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Portland Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Providence Bi-peds&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Antonio Bike Shop&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;San Francisco Cruisers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Seattle Race Equipment&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Tampa 29ers&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Wichita Speed&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0174825&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0066445&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0128205&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0117340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099206&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0062893&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0075949&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0184783&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0129870&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0244898&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112755&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0159151&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215054&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0194175&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059172&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0069930&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040650&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0170940&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139070&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158730&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0031348&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0110759&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0158456&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094340&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112360&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0173410&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0021739&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0074074&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0095238&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0040816&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0190275&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0239852&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0149502&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182529&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0213608&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0016026&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0251572&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0140449&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0167428&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086957&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0242424&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053050&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108696&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0092251&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0156250&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0104895&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099668&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0081301&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050761&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152108&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0059524&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181962&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0138289&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0220126&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0084270&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0076104&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086705&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097826&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0086580&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0232558&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106101&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0155280&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0147601&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0107527&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0234375&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0291262&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0019724&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0034965&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0033223&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0025381&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042735&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0169492&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0119048&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0102848&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0181504&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0032051&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0050633&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0042135&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152207&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0202312&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0043478&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0049383&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0051948&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0204082&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0162086&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0201863&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0322581&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0097087&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD Disc Ultegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139860&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0265781&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0203252&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0153453&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0101523&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0108648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0079365&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0094044&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0106598&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0112179&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0157233&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0278481&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210674&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0182648&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0375723&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0152174&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0172840&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0103896&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0163265&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0126850&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026525&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0139752&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0073801&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0053763&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0026738&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0078125&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0000000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0098619&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;k-means-clustering-a-classanchor-idkmeansa&quot;&gt;K-Means Clustering &lt;a class=&quot;anchor&quot; id=&quot;kmeans&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Now we are ready to perform &lt;em&gt;k&lt;/em&gt;-means clustering to segment our customer-base. Think of clusters as groups in the customer-base. Prior to starting we will need to choose the number of customer groups, &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt;, that are to be detected. The best way to do this is to think about the customer-base and our hypothesis. We believe that there are most likely to be at least four customer groups because of mountain bike vs road bike and premium vs affordable preferences. We also believe there could be more as some customers may not care about price but may still prefer a specific bike category. However, we’ll limit the clusters to eight as more is likely to overfit the segments.&lt;/p&gt;

&lt;h3 id=&quot;running-the-k-means-algorithm-a-classanchor-idrunning-algorithma&quot;&gt;Running the K-Means Algorithm &lt;a class=&quot;anchor&quot; id=&quot;running-algorithm&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The code below does the following:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Converts the &lt;code&gt;customerTrends&lt;/code&gt; data frame into &lt;code&gt;kmeansDat.t&lt;/code&gt;.&lt;/strong&gt; The model and features are dropped so the customer columns are all that are left. The data frame is transposed to have the customers as rows and models as columns. The &lt;code&gt;kmeans()&lt;/code&gt; function requires this format.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Performs the &lt;code&gt;kmeans()&lt;/code&gt; function to cluster the customer segments.&lt;/strong&gt; We set &lt;code&gt;minClust&lt;/code&gt; = 4 and &lt;code&gt;maxClust&lt;/code&gt; = 8. From our hypothesis, we expect there to be at least four and at most six groups of customers. This is because customer preference is expected to vary by price (high/low) and category1 (mountain vs bike). There may be other groupings as well. Beyond eight segments may be overfitting the segments.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Uses the &lt;code&gt;silhouette()&lt;/code&gt; function to obtain silhouette widths.&lt;/strong&gt; &lt;a href=&quot;https://en.wikipedia.org/wiki/Silhouette_(clustering)&quot;&gt;Silhouette&lt;/a&gt; is a technique in clustering that validates the best cluster groups. The &lt;code&gt;silhouette()&lt;/code&gt; function from the &lt;code&gt;cluster&lt;/code&gt; package allows us to get the average width of silhouettes, which will be used to programmatically determine the optimal cluster size.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Running the k-means algorithm -------------------------------------------------
library(cluster) # Needed for silhouette function

kmeansDat &amp;lt;- customerTrends[,-(1:5)]  # Extract only customer columns
kmeansDat.t &amp;lt;- t(kmeansDat)  # Get customers in rows and products in columns

# Setup for k-means loop 
km.out &amp;lt;- list()
sil.out &amp;lt;- list()
x &amp;lt;- vector()
y &amp;lt;- vector()
minClust &amp;lt;- 4      # Hypothesized minimum number of segments
maxClust &amp;lt;- 8      # Hypothesized maximum number of segments

# Compute k-means clustering over various clusters, k, from minClust to maxClust
for (centr in minClust:maxClust) {
        i &amp;lt;- centr-(minClust-1) # relevels start as 1, and increases with centr
        set.seed(11) # For reproducibility
        km.out[i] &amp;lt;- list(kmeans(kmeansDat.t, centers = centr, nstart = 50))
        sil.out[i] &amp;lt;- list(silhouette(km.out[[i]][[1]], dist(kmeansDat.t)))
        # Used for plotting silhouette average widths
        x[i] = centr  # value of k
        y[i] = summary(sil.out[[i]])[[4]]  # Silhouette average width
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Next, we plot the silhouette average widths for the choice of clusters. The best cluster is the one with the largest silhouette average width, which turns out to be 5 clusters.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Plot silhouette results to find best number of clusters; closer to 1 is better
library(ggplot2)
ggplot(data = data.frame(x, y), aes(x, y)) + 
  geom_point(size=3) + 
  geom_line() +
  xlab(&amp;quot;Number of Cluster Centers&amp;quot;) +
  ylab(&amp;quot;Silhouette Average Width&amp;quot;) +
  ggtitle(&amp;quot;Silhouette Average Width as Cluster Center Varies&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-8-7-CustomerSegmentationPt1/silhouettePlot-1.png&quot; alt=&quot;plot of chunk silhouettePlot&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;which-customers-are-in-each-segment-a-classanchor-idcustomer-segmentsa&quot;&gt;Which Customers are in Each Segment? &lt;a class=&quot;anchor&quot; id=&quot;customer-segments&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Now that we have clustered the data, we can inspect the groups find out which customers are grouped together. The code below groups the customer names by cluster X1 through X5.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Get customer names that are in each segment ----------------------------------

# Get attributes of optimal k-means output
maxSilRow &amp;lt;- which.max(y)          # Row number of max silhouette value
optimalClusters &amp;lt;- x[maxSilRow]    # Number of clusters
km.out.best &amp;lt;- km.out[[maxSilRow]] # k-means output of best cluster

# Create list of customer names for each cluster
clusterNames &amp;lt;- list()
clusterList &amp;lt;- list()
for (clustr in 1:optimalClusters) {
  clusterNames[clustr] &amp;lt;- paste0(&amp;quot;X&amp;quot;, clustr)
  clusterList[clustr] &amp;lt;- list(
    names(
        km.out.best$cluster[km.out.best$cluster == clustr]
        )
    )
}
names(clusterList) &amp;lt;- clusterNames

print(clusterList)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;text&quot;&gt;## $X1
## [1] &amp;quot;Ithaca Mountain Climbers&amp;quot;     &amp;quot;Pittsburgh Mountain Machines&amp;quot;
## [3] &amp;quot;Tampa 29ers&amp;quot;                 
## 
## $X2
## [1] &amp;quot;Philadelphia Bike Shop&amp;quot; &amp;quot;San Antonio Bike Shop&amp;quot; 
## 
## $X3
## [1] &amp;quot;Ann Arbor Speed&amp;quot;              &amp;quot;Austin Cruisers&amp;quot;             
## [3] &amp;quot;Indianapolis Velocipedes&amp;quot;     &amp;quot;Miami Race Equipment&amp;quot;        
## [5] &amp;quot;Nashville Cruisers&amp;quot;           &amp;quot;New Orleans Velocipedes&amp;quot;     
## [7] &amp;quot;Oklahoma City Race Equipment&amp;quot; &amp;quot;Seattle Race Equipment&amp;quot;      
## 
## $X4
##  [1] &amp;quot;Albuquerque Cycles&amp;quot;    &amp;quot;Dallas Cycles&amp;quot;        
##  [3] &amp;quot;Denver Bike Shop&amp;quot;      &amp;quot;Detroit Cycles&amp;quot;       
##  [5] &amp;quot;Kansas City 29ers&amp;quot;     &amp;quot;Los Angeles Cycles&amp;quot;   
##  [7] &amp;quot;Minneapolis Bike Shop&amp;quot; &amp;quot;New York Cycles&amp;quot;      
##  [9] &amp;quot;Phoenix Bi-peds&amp;quot;       &amp;quot;Portland Bi-peds&amp;quot;     
## [11] &amp;quot;Providence Bi-peds&amp;quot;   
## 
## $X5
## [1] &amp;quot;Cincinnati Speed&amp;quot;          &amp;quot;Columbus Race Equipment&amp;quot;  
## [3] &amp;quot;Las Vegas Cycles&amp;quot;          &amp;quot;Louisville Race Equipment&amp;quot;
## [5] &amp;quot;San Francisco Cruisers&amp;quot;    &amp;quot;Wichita Speed&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;determining-the-preferences-of-the-customer-segments-a-classanchor-iddetermine-prefsa&quot;&gt;Determining the Preferences of the Customer Segments &lt;a class=&quot;anchor&quot; id=&quot;determine-prefs&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The easiest way to determine the customer preferences is by inspection of factors related to the model (e.g. price point, category of bike, etc). Advanced algorithms to classify the groups can be used if there are many factors, but typically this is not necessary as the trends tend to jump out. The code below attaches the &lt;em&gt;k&lt;/em&gt;-means centroids to the bike models and categories for trend inspection.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Combine cluster centroids with bike models for feature inspection ------------
custSegmentCntrs &amp;lt;- t(km.out.best$centers)  # Get centroids for groups
colnames(custSegmentCntrs) &amp;lt;- make.names(colnames(custSegmentCntrs))
customerTrends.clustered &amp;lt;- cbind(customerTrends[,1:5], custSegmentCntrs)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now, on to cluster inspection.&lt;/p&gt;

&lt;h4 id=&quot;cluster-1&quot;&gt;Cluster 1&lt;/h4&gt;

&lt;p&gt;We’ll order by cluster 1’s top ten bike models in descending order. We can quickly see that the top 10 models purchased are predominantly high-end and mountain. The all but one model has a carbon frame. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Arrange top 10 bike models by cluster in descending order --------------------
attach(customerTrends.clustered)  # Allows ordering by column name
knitr::kable(head(customerTrends.clustered[order(-X1), c(1:5, 6)], 10))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;X1&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;46&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Scalpel-Si Carbon 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0342692&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;42&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0302818&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;53&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Scalpel 29 Carbon Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0280391&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;96&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0259353&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;35&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Habit Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0233750&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;97&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0232606&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;20&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Catalyst 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0215639&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;40&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;62&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Dura Ace 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210578&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;95&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[3500,12790]&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0210433&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;cluster-2&quot;&gt;Cluster 2&lt;/h4&gt;

&lt;p&gt;Next, we’ll inspect cluster 2. We can see that the top models are all low-end/affordable models. There’s a mix of road and mountain for the primariy category and a mix of frame material as well.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Arrange top 10 bike models by cluster in descending order
knitr::kable(head(customerTrends.clustered[order(-X2), c(1:5, 7)], 10))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;X2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;57&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Slice Ultegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Triathalon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0554531&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;97&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0304147&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD12 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0270792&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0263331&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;89&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0249397&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Bad Habit 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0229976&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;26&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;F-Si Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cross Country Race&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0224490&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;CAAD12 Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0209568&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;81&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Synapse Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Endurance Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0209568&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;90&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Sport&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;[ 415, 3500)&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0203094&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;detach(customerTrends.clustered)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;clusters-3-4--5&quot;&gt;Clusters 3, 4 &amp;amp; 5&lt;/h4&gt;

&lt;p&gt;Inspecting clusters 3, 4 and 5 produce interesting results. For brevity, we won’t display the tables. Here’s the results:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cluster 3: Tends to prefer road bikes that are low-end. &lt;/li&gt;
  &lt;li&gt;Cluster 4: Is very similar to Cluster 2 with the majority of bikes in the low-end price range. &lt;/li&gt;
  &lt;li&gt;Cluster 5: Tends to refer road bikes that are high-end.  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;reviewing-results-a-classanchor-idreviewa&quot;&gt;Reviewing Results &lt;a class=&quot;anchor&quot; id=&quot;review&quot;&gt;&lt;/a&gt;&lt;/h4&gt;

&lt;p&gt;Once the clustering is finished, it’s a good idea to take a step back and review what the algorithm is saying. For our analysis, we got clear trends for four of five groups, but two groups (clusters 2 and 4) are very similar. Because of this, it may make sense to combine these two groups or to switch from &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; = 5 to &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; = 4 results. &lt;/p&gt;

&lt;h2 id=&quot;recap-a-classanchor-idrecapa&quot;&gt;Recap &lt;a class=&quot;anchor&quot; id=&quot;recap&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The customer segmentation process can be performed with various clustering algorithms. In this post, we focused on &lt;em&gt;k&lt;/em&gt;-means clustering in &lt;code&gt;R&lt;/code&gt;. While the algorithm is quite simple to implement, half the battle is getting the data into the correct format and interpreting the results. We went over formatting the order data, running the &lt;code&gt;kmeans()&lt;/code&gt; function to cluster the data with several hypothetical &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; clusters, using &lt;code&gt;silhouette()&lt;/code&gt; from the &lt;code&gt;cluster&lt;/code&gt; package to determine the optimal number of &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; clusters, and interpreting the results by inspection of the &lt;em&gt;k&lt;/em&gt;-means centroids. Happy clustering!&lt;/p&gt;

&lt;h2 id=&quot;further-reading-a-classanchor-idfurther-readinga&quot;&gt;Further Reading &lt;a class=&quot;anchor&quot; id=&quot;further-reading&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.wiley.com/WileyCDA/WileyTitle/productCd-111866146X.html&quot;&gt;Data Smart by John Foreman&lt;/a&gt;: Chapter 2 covers k-medians clustering and silhouette analysis, which is very similar to the approach I use here.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;updates-a-classanchor-idupdatesa&quot;&gt;Updates &lt;a class=&quot;anchor&quot; id=&quot;updates&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;August 28, 2016: There was an issue with the &lt;code&gt;set.seed()&lt;/code&gt; being outside of the for-loop in the &lt;em&gt;k&lt;/em&gt;-means algorithm preventing the kmeans output from being completely reproducible. The &lt;code&gt;set.seed()&lt;/code&gt; was moved inside the for-loop.&lt;/li&gt;
&lt;/ol&gt;
</content>
      
      <category>R-Project</category>
      
      <category>R</category>
      
      <category>Customer Segmentation</category>
      
      <category>Community Detection</category>
      
      <category>kmeans</category>
      
      <category>silhouette</category>
      
      <category>bikes data set</category>
      
      
      <category>Business</category>
      
    </entry>
  
    <entry>
      <title>orderSimulatoR: Simulate Orders for Business Analytics</title>
      <link href="http://www.mattdancho.com/Business/2016/07/12/orderSimulatoR.html" />
      <updated>2016-07-12T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Business/2016/07/12/orderSimulatoR</id>
      <content type="html">&lt;p&gt;In this post, we will be discussing &lt;code&gt;orderSimulatoR&lt;/code&gt;, which enables &lt;strong&gt;fast and easy &lt;code&gt;R&lt;/code&gt; order simulation for customer and product learning&lt;/strong&gt;. The basic premise is to simulate data that you’d retrieve from a &lt;code&gt;SQL&lt;/code&gt; query of an ERP system. The data can then be merged with products and customers tables to data mine. I’ll go through the basic steps to create an order data set that combines customers and products, and I’ll wrap up with some visualizations to show how you can use order data to expose trends. You can get the scripts and the Cannondale &lt;code&gt;bikes data set&lt;/code&gt; at the &lt;code&gt;orderSimulatoR&lt;/code&gt; &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR&quot;&gt;GitHub repository&lt;/a&gt;. In case you are wondering what simulated orders look like, click &lt;a href=&quot;#joining-orders&quot;&gt;here&lt;/a&gt; to scroll to the end result.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;About the Photo:&lt;/strong&gt;
The bicycle in the photo is one of Cannondale’s top-of-the-line cross-country mountain bikes, the Scalpel. The &lt;code&gt;orderSimulatoR&lt;/code&gt; scripts were used to create the Cannondale &lt;code&gt;bikes data set&lt;/code&gt;, which simulates orders for the bicycle manufacturer, Cannondale. The data set uses their 2016 models. For more information, visit their website at &lt;a href=&quot;http://www.cannondale.com/en/USA&quot;&gt;www.cannondale.com&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#why&quot;&gt;Why orderSimulatoR?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-started&quot;&gt;Getting Started&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#customers&quot;&gt;Customers&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#products&quot;&gt;Products&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#customer-product-interactions&quot;&gt;Customer-Product Interactions&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#creating-customer-orders&quot;&gt;Creating Customer Orders&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#step1&quot;&gt;Step 1: Create Orders and Lines&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#step2&quot;&gt;Step 2: Add Dates to the Orders&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#step3&quot;&gt;Step 3: Assign Customers to Orders&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#step4&quot;&gt;Step 4: Assign Products to Order Lines&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#step5&quot;&gt;Step 5: Assign Quantities to Order Lines&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#joining-orders&quot;&gt;Joining Orders with Customers and Products&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#exploring-orders&quot;&gt;Exploring the Orders&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#sales-over-time&quot;&gt;Sales Over Time&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#top-10-products&quot;&gt;Top 10 Products&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#geographic-trends&quot;&gt;Geographic Customer Trends&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#recap&quot;&gt;Recap&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;why-ordersimulator-a-classanchor-idwhya&quot;&gt;Why orderSimulatoR? &lt;a class=&quot;anchor&quot; id=&quot;why&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;It’s very difficult to create order data with trends for data mining and visualization. I’ve searched for good data sets, and I’ve come to the conclusion that I’m better off creating my own orders data for analyzing on my blog. In the process, I made a collection of &lt;code&gt;R&lt;/code&gt; scripts that became known as &lt;code&gt;orderSimulatoR&lt;/code&gt;. The scripts are &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR&quot;&gt;publicly available&lt;/a&gt; so others can simulate orders for customers and products in any sales/marketing situation. The process to create orders (shown below) is fast and easy, and the result is orders with customized trends depending on the inputs you create and the parameters you select.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/OrderSimProcess.jpg&quot; alt=&quot;Order Simulation Process&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;getting-started-a-classanchor-idgetting-starteda&quot;&gt;Getting Started &lt;a class=&quot;anchor&quot; id=&quot;getting-started&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Prior to starting, you’ll need three data frames:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Customers&lt;/li&gt;
  &lt;li&gt;Products&lt;/li&gt;
  &lt;li&gt;Customer-Product Interactions&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I’ll briefly go through each using the Cannondale &lt;code&gt;bikes data set&lt;/code&gt;. If you’re following along, you can access the &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR/tree/master/data&quot;&gt;excel files here&lt;/a&gt;. Alternatively, you can generate your own data frames of customers, products and customer-production interactions. Note that the &lt;code&gt;orders.xlsx&lt;/code&gt; file is what we will be generating in data frame form. The code below loads the three data frames. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;library(xlsx) # For read.xlsx() function

# Read inputs to orderSimulatoR process
customers &amp;lt;- read.xlsx(&amp;quot;./data/bikeshops.xlsx&amp;quot;, sheetIndex = 1)
products &amp;lt;- read.xlsx(&amp;quot;./data/bikes.xlsx&amp;quot;, sheetIndex = 1) 
customerProductProbs &amp;lt;- read.xlsx(&amp;quot;./data/customer_product_interactions.xlsx&amp;quot;, 
                                  sheetIndex = 1, 
                                  startRow = 15)

# Format inputs; Remove unnecessary columns
customerProductProbs &amp;lt;- customerProductProbs[,-(2:11)]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;customers-a-classanchor-idcustomersa&quot;&gt;Customers &lt;a class=&quot;anchor&quot; id=&quot;customers&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The customers for the example case are bike shops scattered throughout the United States. I’ve included &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;name&lt;/code&gt;, &lt;code&gt;city&lt;/code&gt; &lt;code&gt;state&lt;/code&gt;, &lt;code&gt;latitude&lt;/code&gt;, and &lt;code&gt;longitude&lt;/code&gt;. The &lt;code&gt;id&lt;/code&gt; is important and must be in the first column for the &lt;code&gt;orderSimulatoR&lt;/code&gt; scripts to work. The other features are up to you. Feel free to get creative when designing your customers data frame by adding features such as region, size, type, etc that would normally be found in a CRM / ERP system. While features beyond the &lt;code&gt;id&lt;/code&gt; are not required for the scripts, it’s a good idea to add them now for data mining later. The first six customer records are shown below.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;library(knitr) # used for kable() function

# Show customers dataframe
kable(head(customers))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;bikeshop.id&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;bikeshop.name&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;bikeshop.city&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;bikeshop.state&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;latitude&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;longitude&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Pittsburgh Mountain Machines&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Pittsburgh&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;PA&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;40.44062&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-79.99589&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca Mountain Climbers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;NY&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42.44396&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-76.50188&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Columbus Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Columbus&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OH&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;39.96118&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-82.99879&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Detroit Cycles&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Detroit&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;MI&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;42.33143&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-83.04575&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cincinnati Speed&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cincinnati&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;OH&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;39.10312&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-84.51202&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;KY&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;38.25267&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;-85.75846&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;products-a-classanchor-idproductsa&quot;&gt;Products &lt;a class=&quot;anchor&quot; id=&quot;products&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The products for the example case are road and mountain bikes made by &lt;a href=&quot;http://www.cannondale.com/en/USA&quot;&gt;Cannondale&lt;/a&gt;, a premier bicycle manufacturer. I’ve included the &lt;code&gt;id&lt;/code&gt; and several other features I found on the website including &lt;code&gt;model&lt;/code&gt;, &lt;code&gt;category1&lt;/code&gt; (Road, Mountain), &lt;code&gt;category2&lt;/code&gt; (Elite Road, Endurance Road, etc), &lt;code&gt;frame&lt;/code&gt; (Carbon, Aluminum), and price. Again, &lt;code&gt;id&lt;/code&gt; is the most important feature and must be in the first column for the scripts to work. As with customers, get creative with the features. We’ll use the features when developing the product-customer interactions, which creates the trends that we’ll data mine. The first six products are shown below.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Show products data frame
kable(head(products))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;bike.id&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;price&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Black Inc.&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12790&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Team&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10660&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Dura Ace 1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7990&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Dura Ace 2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5330&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Utegra&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4260&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Red&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3940&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;customer-product-interactions-a-classanchor-idcustomer-product-interactionsa&quot;&gt;Customer-Product Interactions &lt;a class=&quot;anchor&quot; id=&quot;customer-product-interactions&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The customer-products interactions is a matrix that links the probability of each customer to purchasing each product (i.e. it is a model for each customer’s purchasing preference). The scripts use this matrix to assign products to orders. The probabilities are critical as these will be what create the customer trends in the data. It’s a good idea to check out the excel spreadsheet, &lt;code&gt;customer_product_interactions.xlsx&lt;/code&gt;, which has detailed notes on how to add trends into the customer-product interactions. For the bikes data set, the customers each had a preference for bike style (Road, Mountain, or AnyStyle) and a price range (High and Low). The excel functions assign various probabilities based on how the customer preferences match the product features. A few important points: &lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Product id must be the first column&lt;/li&gt;
  &lt;li&gt;All subsequent columns should be the customers in order of customer id from 1 to the last customer id.&lt;/li&gt;
  &lt;li&gt;Each customer column should sum to 1.0, as this is the product probability density for each customer.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The customer product interactions are shown for the first six customers and products. The way to interpret the matrix is that customer.id.1 has a 0.986% probability of seleting product.id.1 (bike.id = 1).&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Show customer-product interactions data frame
kable(round(customerProductProbs[1:6, 1:6], 4))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;bike.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id.1&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id.2&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id.3&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id.4&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id.5&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0099&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0057&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;0.0196&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;creating-customer-orders-a-classanchor-idcreating-customer-ordersa&quot;&gt;Creating Customer Orders &lt;a class=&quot;anchor&quot; id=&quot;creating-customer-orders&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Once the customer, product and customer-product interaction data frames are finished, you are ready to create orders. The first thing you’ll need is to load the scripts. The scripts can be found &lt;a href=&quot;https://github.com/mdancho84/orderSimulatoR/tree/master/scripts&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Source orderSimulatoR scripts
source(&amp;quot;./scripts/createOrdersAndLines.R&amp;quot;)
source(&amp;quot;./scripts/createDatesFromOrders.R&amp;quot;)
source(&amp;quot;./scripts/assignCustomersToOrders.R&amp;quot;)
source(&amp;quot;./scripts/assignProductsToCustomerOrders.R&amp;quot;)
source(&amp;quot;./scripts/createProductQuantities.R&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;step-1-create-orders-and-lines-a-classanchor-idstep1a&quot;&gt;Step 1: Create Orders and Lines &lt;a class=&quot;anchor&quot; id=&quot;step1&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;First, we’ll create the orders and lines using the &lt;code&gt;createOrdersAndLines()&lt;/code&gt; function. For those unfamiliar with lines, each order typically has several products purchased which are denoted “lines”. The function parameters are number of orders &lt;code&gt;n&lt;/code&gt;, max number of lines &lt;code&gt;maxLines&lt;/code&gt;, and &lt;code&gt;rate&lt;/code&gt;, which affects the distribution of lines on an order.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Quick Digression on the &lt;code&gt;rate&lt;/code&gt; Parameter:&lt;/strong&gt; &lt;/p&gt;

&lt;p&gt;&lt;em&gt;This section gets a little technical, so feel free to skip and you won’t miss much.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Several other &lt;code&gt;orderSimulatoR&lt;/code&gt; functions use a similar &lt;code&gt;rate&lt;/code&gt; parameter, and I recommend playing around with the rates to see how the distribution is affected. The following code generates the probabilities of lines to an order:&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Showing effect of rate on probability of assigning number of lines to orders
maxLines = 10
rate = 1
for (i in 1:maxLines) {
        lineProb[i] &amp;lt;- 1/i^rate         
}
lineProb &amp;lt;- lineProb/sum(lineProb)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The equation iterates through the number of lines to an order, &lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;, from &lt;code&gt;1&lt;/code&gt; to &lt;code&gt;maxLines&lt;/code&gt; in the equation:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;
lineProb_i = \frac{1}{i^{rate}}  
&lt;/script&gt;

&lt;p&gt;Where &lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt; is the number of lines to an order, and &lt;script type=&quot;math/tex&quot;&gt;rate&lt;/script&gt; is the adjustment parameter. As the number of lines to an order, &lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt;, increases, the probability naturally decreases. Because &lt;script type=&quot;math/tex&quot;&gt;i&lt;/script&gt; is raised to the &lt;script type=&quot;math/tex&quot;&gt;rate&lt;/script&gt; parameter, the &lt;script type=&quot;math/tex&quot;&gt;rate&lt;/script&gt; determines how fast or slow the distribution decreases. Larger values cause the distribution to decrease faster, and values close to zero cause the distribution to become more uniform. &lt;/p&gt;

&lt;p&gt;The effect of &lt;code&gt;rate&lt;/code&gt; adjustment can be conveyed by plotting the probability distribution of orders with &lt;code&gt;maxLines&lt;/code&gt; = 10 while adjusting the &lt;code&gt;rate&lt;/code&gt; parameter from 0 to 1.5. At &lt;code&gt;rate&lt;/code&gt; = 0, the probability of a one-line order is 10%, while at a &lt;code&gt;rate&lt;/code&gt; of 1.5 the probability is 50%.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/rateAdjustment-1.png&quot; alt=&quot;plot of chunk rateAdjustment&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Back to Creating Orders and Lines:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;With inputs of &lt;code&gt;n&lt;/code&gt; = 2000, &lt;code&gt;maxLines&lt;/code&gt; = 30, and &lt;code&gt;rate&lt;/code&gt; = 1, the output is a data frame with &lt;strong&gt;2000 orders with 15,644 total rows for each product purchase&lt;/strong&gt;. Some orders have more lines (more product purchases) and others have less (as dictated by the &lt;code&gt;rate&lt;/code&gt; parameter). One note worth mentioning is that the &lt;code&gt;maxLines&lt;/code&gt; cannot exceed the number of products (otherwise an order would have more lines than products available which does not make sense).&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 1 - Create orders
orders &amp;lt;- createOrdersAndLines(n = 2000, maxLines = 30, rate = 1)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Data frame for first 3 orders shown
kable(orders[orders$order.id %in% c(1:3),])&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;step-2-add-dates-to-the-orders-a-classanchor-idstep2a&quot;&gt;Step 2: Add Dates to the Orders &lt;a class=&quot;anchor&quot; id=&quot;step2&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Orders typically have a date recorded so the sales can be tracked by time period (e.g. for assessment of time-based metrics like sales by month, quarter, year, etc). As such, we’ll add dates according the distribution of orders in a given year using the &lt;code&gt;createDatesFromOrders()&lt;/code&gt; function, which takes four parameters: the &lt;code&gt;orders&lt;/code&gt; data frame from Step 1, a &lt;code&gt;startYear&lt;/code&gt;, a &lt;code&gt;yearlyOrderDist&lt;/code&gt;, and a &lt;code&gt;monthlyOrderDist&lt;/code&gt;. The &lt;code&gt;startYear&lt;/code&gt; identifies the beginning of the time span, and the length of the &lt;code&gt;yearlyOrderDist&lt;/code&gt; (length = 5) creates orders spanning five years. Yearly growth/contraction in sales is simulated using the &lt;code&gt;yearlyOrderDist&lt;/code&gt; distribution vector, while seasonality is simulated using the &lt;code&gt;monthlyOrderDist&lt;/code&gt; distribution vector. As shown below, we now have dates added according to our desired yearly and monthly distributions.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 2 - Add dates to the orders
orders &amp;lt;- createDatesFromOrders(orders, 
                                startYear = 2011, 
                                yearlyOrderDist = c(.16, .18, .22, .20, .24),
                                monthlyOrderDist = c(0.045, 
                                                     0.075, 
                                                     0.100, 
                                                     0.110, 
                                                     0.120, 
                                                     0.125, 
                                                     0.100, 
                                                     0.085, 
                                                     0.075, 
                                                     0.060, 
                                                     0.060, 
                                                     0.045))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Top of orders data frame showing beginning dates
kable(head(orders))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The script takes into account no sales on weekends, but does not account for holidays (e.g. Christmas, Thanksgiving, etc). The last six rows of the &lt;code&gt;orders&lt;/code&gt; data frame are shown below.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Bottom of orders data frame showing ending dates
kable(tail(orders))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt; &lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15639&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15640&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15641&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15642&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15643&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;7&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;15644&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2000&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;8&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2015-12-25&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;We can use a heatmap to graphically view the order distribution by year and month to get an idea for how the order dates were assigned. As expected, the seasonality of orders follows the &lt;code&gt;monthlyOrderDist&lt;/code&gt; distribution, with the majority of orders coming in March through July. The orders increase following the &lt;code&gt;yearlyOrderDist&lt;/code&gt; distribution.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/orderDistMonthYear-1.png&quot; alt=&quot;plot of chunk orderDistMonthYear&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-3-assign-customers-to-orders-a-classanchor-idstep3a&quot;&gt;Step 3: Assign Customers to Orders &lt;a class=&quot;anchor&quot; id=&quot;step3&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Next, we’ll assign customers to orders using the &lt;code&gt;assignCustomersToOrders()&lt;/code&gt; function. The parameters needed are the &lt;code&gt;orders&lt;/code&gt; data frame from Step 2, the &lt;code&gt;customers&lt;/code&gt; data frame, and the &lt;code&gt;rate&lt;/code&gt; parameter, which controls the distribution of orders assigned to customers. Similar to the &lt;code&gt;rate&lt;/code&gt; parameter in Step 1, a larger rate increases the number of orders assigned to the largest customers, and as the rate decreases to zero the distribution approaches a uniform distribution. As shown below, orders now have customer id’s.  &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 3 - Assign customers to the orders
orders &amp;lt;- assignCustomersToOrders(orders, customers, rate = 0.8)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Data frame for first 3 orders shown
kable(orders[orders$order.id %in% c(1:3),])&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Using a &lt;code&gt;rate&lt;/code&gt; = 0.8 still assigns a wide range of orders to customers, and we can see the distribution of order rows by customer in the plot below. Customer 10 has the most order rows at 2731, while Customer 21 has the least order rows at 108.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/customerDistribution-1.png&quot; alt=&quot;plot of chunk customerDistribution&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-4-assign-products-to-orders-lines-a-classanchor-idstep4a&quot;&gt;Step 4: Assign Products to Orders Lines &lt;a class=&quot;anchor&quot; id=&quot;step4&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;In step 4, we’ll assign products to the orders using the customer-product interaction table. Keep in mind that this is the critical step where a well-thought-out customer-product interaction table will allow us to uncover deep trends and insights into customer behavior. The &lt;code&gt;assignProductsToCustomerOrders()&lt;/code&gt; function takes two arguments: the &lt;code&gt;orders&lt;/code&gt; data frame from Step 3 and the &lt;code&gt;customerProductProbs&lt;/code&gt; table, which contains the matrix of probabilities linking product.id to customer.id.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 4 - Assign products to orders
orders &amp;lt;- assignProductsToCustomerOrders(orders, customerProductProbs)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Data frame for first 3 orders shown
kable(orders[orders$order.id %in% c(1:3),])&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;product.id&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;48&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;52&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;76&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;52&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;50&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;34&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;step-5-assign-quantities-to-order-lines-a-classanchor-idstep5a&quot;&gt;Step 5: Assign Quantities to Order Lines &lt;a class=&quot;anchor&quot; id=&quot;step5&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;In the last step, we assign quantities to the order lines using the &lt;code&gt;createProductQuantities()&lt;/code&gt; function. The function takes three parameters: the &lt;code&gt;orders&lt;/code&gt; data frame from Step 4, the &lt;code&gt;maxQty&lt;/code&gt;, and the &lt;code&gt;rate&lt;/code&gt;. The &lt;code&gt;maxQty&lt;/code&gt; parameter limits the quantity of products on a order line while the &lt;code&gt;rate&lt;/code&gt; parameter controls the distribution. A &lt;code&gt;maxQty&lt;/code&gt; = 10 and a &lt;code&gt;rate&lt;/code&gt; = 3 places an 83.5% probability on a line quantity of 1, whereas a line quantity of 10 (maximum quantity) has a 0.08% probability. &lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Step 5 - Create product quantities
orders &amp;lt;- createProductQuantities(orders, maxQty = 10, rate = 3)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Data frame for first 3 orders shown
kable(orders[orders$order.id %in% c(1:3),])&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;customer.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;product.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;quantity&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;48&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;52&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;76&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;52&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;50&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;34&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;joining-orders-with-customers-and-products-a-classanchor-idjoining-ordersa&quot;&gt;Joining Orders with Customers and Products &lt;a class=&quot;anchor&quot; id=&quot;joining-orders&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The orders table alone does not give us much information. For instance, we don’t know the names of the customers, the products purchased, or the sales values. Let’s combine some of the tables to make the information more useful.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Merge customers and products data with the orders to produce and orders.extended data frame
library(dplyr)

orders.extended &amp;lt;- merge(orders, customers, by.x = &amp;quot;customer.id&amp;quot;, by.y=&amp;quot;bikeshop.id&amp;quot;)
orders.extended &amp;lt;- merge(orders.extended, products, by.x = &amp;quot;product.id&amp;quot;, by.y = &amp;quot;bike.id&amp;quot;)

orders.extended &amp;lt;- orders.extended %&amp;gt;%
        mutate(price.extended = price * quantity) %&amp;gt;%
        select(order.date, order.id, order.line, bikeshop.name, model, 
               quantity, price, price.extended, category1, category2, frame) %&amp;gt;%
        arrange(order.id, order.line)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Data frame for first 3 orders shown
kable(orders.extended[orders.extended$order.id %in% c(1:3),])&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;order.date&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.id&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;order.line&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;bikeshop.name&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;model&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;quantity&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;price&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;price.extended&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category1&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;category2&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;frame&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca Mountain Climbers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6070&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;6070&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-07&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Ithaca Mountain Climbers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Kansas City 29ers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Beast of the East 1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2770&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2770&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trail&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Kansas City 29ers&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trigger Carbon 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5970&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Team&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10660&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;10660&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Jekyll Carbon 4&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3200&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3200&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Over Mountain&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Black Inc.&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12790&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12790&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Supersix Evo Hi-Mod Dura Ace 2&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5330&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5330&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Elite Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Carbon&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2011-01-10&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;3&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;5&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Louisville Race Equipment&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Synapse Disc 105&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1570&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;1570&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Endurance Road&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Aluminum&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Great. Now this finally looks like orders data that could be retrieved from an ERP system. We are ready to start visualizing and data mining. The last part of this post will go into some high level visualizations for data exploration. Future blog posts will dig much deeper.&lt;/p&gt;

&lt;h2 id=&quot;exploring-the-orders-a-classanchor-idexploring-ordersa&quot;&gt;Exploring the Orders &lt;a class=&quot;anchor&quot; id=&quot;exploring-orders&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;If you’ve followed along to this point, we have just created the orders from the &lt;code&gt;bikes data set&lt;/code&gt;. Now, we can have some fun! Let’s examine the data set. &lt;/p&gt;

&lt;h3 id=&quot;sales-over-time-a-classanchor-idsales-over-timea&quot;&gt;Sales Over Time &lt;a class=&quot;anchor&quot; id=&quot;sales-over-time&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;We’ll first take a look at sales over time using the &lt;code&gt;ggplot2&lt;/code&gt; package.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Plotting sales over time
library(ggplot2)
library(lubridate)

# Create a sales by year data frame
salesByYear &amp;lt;- orders.extended %&amp;gt;%
  group_by(year = year(order.date)) %&amp;gt;%
  summarize(total.sales = sum(price.extended))

# Use ggplot to plot sales by year
ggplot(salesByYear, aes(x=year, y=total.sales)) +
  geom_bar(stat = &amp;quot;identity&amp;quot;) + 
  geom_smooth(method = &amp;quot;lm&amp;quot;, se = FALSE) +
  labs(title=&amp;quot;Sales Over Time&amp;quot;, x=&amp;quot;Year&amp;quot;, y=&amp;quot;Sales&amp;quot;) +
  scale_y_continuous(labels = scales::dollar) +
  geom_text(aes(ymax=total.sales, label=scales::dollar(total.sales)), 
                        vjust=1.5, 
                        color=&amp;quot;white&amp;quot;,
                        size=4)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/salesOverTime-1.png&quot; alt=&quot;Sales Over Time&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nice. Cannondale has a general growth trend. It looks like 2015 was Cannondale’s best year with $17,171,510 in total sales! &lt;/p&gt;

&lt;h3 id=&quot;top-10-products-a-classanchor-idtop-10-productsa&quot;&gt;Top 10 Products &lt;a class=&quot;anchor&quot; id=&quot;top-10-products&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Next, let’s explore some products to get an idea of top sellers.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Plot top 10 products

# Create top 10 products data frame
productSales &amp;lt;- orders.extended %&amp;gt;%
  group_by(bike.model = model) %&amp;gt;%
  summarize(total.sales = sum(price.extended),
            qty.total = sum(quantity)) %&amp;gt;%
  mutate(pct.total = total.sales / sum(total.sales)) %&amp;gt;%
  arrange(desc(total.sales))
top10.ordered &amp;lt;- head(productSales, 10)
top10.ordered$bike.model &amp;lt;- factor(top10.ordered$bike.model, levels = arrange(top10.ordered, total.sales)$bike.model)

# Use ggplot to plot the top products
ggplot(top10.ordered, aes(x=bike.model, y=total.sales)) +
  geom_bar(stat=&amp;quot;identity&amp;quot;) + 
  geom_text(aes(ymax=pct.total, label=scales::percent(pct.total)), 
      hjust= -0.25,
      vjust= 0.5,
      color=&amp;quot;black&amp;quot;,
      size=4) +
  geom_text(aes(ymax=qty.total, label=paste(&amp;quot;Qty:&amp;quot;, qty.total)), 
      hjust= 1.25,
      vjust= 0.5,
      color=&amp;quot;white&amp;quot;,
      size=4) +
  coord_flip() +
  labs(title=&amp;quot;Top 10 Bike Models&amp;quot;, 
       x=&amp;quot;&amp;quot;, 
       y=&amp;quot;Sales&amp;quot;)+
  scale_y_continuous(labels = scales::dollar, limits = c(0,2500000))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/figure/source/2016-7-12-orderSimulatoR/top10Products-1.png&quot; alt=&quot;Top 10 Products&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It looks like the best model is the Cannondale Scalpel-Si Black Inc. with 168 units sold representing sales of $2,148,720 or 3.02% of total sales. &lt;/p&gt;

&lt;h3 id=&quot;geographic-customer-trends-a-classanchor-idgeographic-trendsa&quot;&gt;Geographic Customer Trends &lt;a class=&quot;anchor&quot; id=&quot;geographic-trends&quot;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;Finally, we’ll take a look at a map of our customer-base using the &lt;code&gt;leaflet&lt;/code&gt; package. The map below charts the customer locations and exposes the sales trends using the circle radius. Larger circles relate to higher sales, and smaller circles relate to lower sales. You can click on the markers to see the bike shop name and sales.&lt;/p&gt;

&lt;div&gt;
  &lt;pre&gt;&lt;code class=&quot;r&quot;&gt;# Plot sales by geographic location

# Create sales by location from orders extedend, joining latitude and longitude
# data by customer name
salesByLocation &amp;lt;- orders.extended %&amp;gt;%
  group_by(bikeshop.name) %&amp;gt;%
  summarise(total.sales = sum(price.extended)) %&amp;gt;%
  left_join(y=customers, by=&amp;quot;bikeshop.name&amp;quot;) %&amp;gt;%
  mutate(popup = paste0(bikeshop.name, &amp;quot;: &amp;quot;, scales::dollar(total.sales)))

# Use Leaflet package to create map visualizing sales by customer location
library(leaflet)
leaflet(salesByLocation) %&amp;gt;% 
  addProviderTiles(&amp;quot;CartoDB.Positron&amp;quot;) %&amp;gt;%
  addMarkers(lng = ~longitude, 
             lat = ~latitude,
             popup = ~popup) %&amp;gt;%
  addCircles(lng = ~longitude, 
             lat = ~latitude, 
             weight = 2,
             radius = ~(total.sales)^0.775)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;iframe src=&quot;http://rpubs.com/mdancho84/BikeSaleByLocation&quot; style=&quot;border: none; width: 750px; height: 600px&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;This is elightening. Not only is it easy to see who are largest customers are and their locations, but we can see geographic trends. It looks like the southeast US and the midwest are realatively unsaturated geographies. This could be an opportunity to partner with bikeshops in those areas!&lt;/p&gt;

&lt;h2 id=&quot;recap-a-classanchor-idrecapa&quot;&gt;Recap &lt;a class=&quot;anchor&quot; id=&quot;recap&quot;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Ok, you’ve made it through a long post, but one that hopefully helps you show off your analytic talents. We discussed how to simulate orders using the &lt;code&gt;orderSimulatoR&lt;/code&gt; scripts, which can be used to simulate orders in any situation that has customers and products. All you need is a customer table, products table, and a well-thought-out matrix of probabilities that create the customer-product interaction trends. The simulated orders can then be used for data mining and visualizations. We went through a few high level data visualizations on the &lt;code&gt;bikes data set&lt;/code&gt;. We used the &lt;code&gt;ggplot2&lt;/code&gt; and &lt;code&gt;leaflet&lt;/code&gt; packages to help understand the overall sales trends, best products, and best customers. With that said, we just scratched the surface of the data mining and visualization process. In future posts, we’ll take a look at more advanced techniques for uncover trends. Until then, onward and upward.&lt;/p&gt;

&lt;h2 id=&quot;further-resources&quot;&gt;Further Resources&lt;/h2&gt;

&lt;p&gt;For more &lt;code&gt;R&lt;/code&gt; resources, visit &lt;a href=&quot;http://www.r-bloggers.com/&quot;&gt;R-Bloggers&lt;/a&gt;, a site dedicated to &lt;code&gt;R&lt;/code&gt;. There’s a wealth of &lt;code&gt;R&lt;/code&gt; information, and you may even see this post. Happy analyzing.&lt;/p&gt;
</content>
      
      <category>R-Project</category>
      
      <category>R</category>
      
      <category>Simulation</category>
      
      <category>Data Mining</category>
      
      <category>orderSimulatoR</category>
      
      <category>bikes data set</category>
      
      
      <category>Business</category>
      
    </entry>
  
    <entry>
      <title>Marketing Strategy: Why MBAs Can Benefit from Learning Analytics</title>
      <link href="http://www.mattdancho.com/Business/2016/05/01/Marketing-Strategy-MBAs-Learn-Analytics.html" />
      <updated>2016-05-01T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Business/2016/05/01/Marketing-Strategy-MBAs-Learn-Analytics</id>
      <content type="html">&lt;p&gt;Just because you’re a business professional does not mean you can’t or you shouldn’t pursue furthering yourself in analytics. Businesses view strategic decision making as a &lt;strong&gt;&lt;em&gt;competitive advantage&lt;/em&gt;&lt;/strong&gt;. You should too! Learning the basics behind data science not only adds value to your organization, it &lt;strong&gt;&lt;em&gt;increases your value&lt;/em&gt;&lt;/strong&gt; and thus your demand too.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;About the image:&lt;/strong&gt; Sifting through data can feel like a scene out of &lt;em&gt;“The Matrix”&lt;/em&gt; with 1’s and 0’s staring back at you as you try to gain insight out of information.
The reality is adding analytics tools to your skillset can help significantly improve your ability to gain insight and better your decision making. This is the heart of business intelligence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;My background is primarily in manufacturing, which is where I will have seen the issues that I discuss below. However, I believe these issues transcend organizations in all sectors and disciplines including banking, healthcare, manufacturing, technology, and more.&lt;/p&gt;

&lt;h2 id=&quot;the-problem&quot;&gt;The Problem:&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Companies have massive datasets of sales information stored in ERP and other relational databases.  ERP systems (e.g. Oracle, SAP) are great at keeping operational data tracked and managed, but fail at presenting the information in useful ways. This is where the market for CRM developed, which has become a &lt;a href=&quot;http://www.crmsearch.com/crm-market-share.php&quot;&gt;$24B market as of 2014 according to crmsearch.com&lt;/a&gt;. Further, the market for CRM continues to surge at a 15% annual growth rate. This all adds up to one thing: a massive need to analyze data.&lt;/p&gt;

&lt;p&gt;CRM tools exist to help analyze these datasets. Customer trends can be subset, filtered, aggregated, and more as fast as you can click your mouse. However, tools like &lt;a href=&quot;https://www.salesforce.com/&quot;&gt;Salesforce&lt;/a&gt; while amazingly powerful have limitations. These tools are primarily useful for dashboards. While great for visualizations to see what is happening historically and to summarize mass information, dashboards are typically not useful for true, in-depth analysis. &lt;strong&gt;&lt;em&gt;Organizations need to think beyond CRM&lt;/em&gt;&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This is where the data analyst comes in.&lt;/p&gt;

&lt;h2 id=&quot;the-solution&quot;&gt;The Solution:&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;True, in-depth analysis requires data analytics by someone that can perform statistical calculations. They don’t have to be masters of the black arts. They just need to be competent in software (e.g. &lt;code&gt;R&lt;/code&gt;, &lt;code&gt;Python&lt;/code&gt;, and &lt;code&gt;SQL&lt;/code&gt;) and have a general knowledge of the statistical tools available to them.&lt;/p&gt;

&lt;p&gt;MBA professionals can and should learn analytics because the tools get results and analytics skills increase the value MBAs bring to their organization. Being able to process information for decision making is a &lt;strong&gt;&lt;em&gt;competitive advantage&lt;/em&gt;&lt;/strong&gt;. Here are a few key metrics to consider if you are an MBA considering adding data science to your skillset:&lt;/p&gt;

&lt;h4 id=&quot;the-demand-for-analysts-is-growing&quot;&gt;The demand for analysts is growing:&lt;/h4&gt;

&lt;p&gt;Companies want individuals with analytical skills. According to &lt;a href=&quot;http://www.indeed.com/&quot;&gt;indeed.com&lt;/a&gt;, on a relative basis the job postings for Data Scientists have grown over &lt;strong&gt;&lt;em&gt;1700%&lt;/em&gt;&lt;/strong&gt; from 2012 to 2016.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/data_science_trends.jpg&quot; alt=&quot;Data Scientist Job Trends&quot; /&gt;
&amp;lt;p class=&quot;text-center date&quot;&amp;gt;Source: &lt;a href=&quot;http://www.indeed.com/&quot;&gt;indeed.com&lt;/a&gt;&amp;lt;/p&amp;gt;&lt;/p&gt;

&lt;p&gt;While this constitutes all “Data Scientists” including those involved in machine learning, big data, and other computational disciplines, it shows the increasing trends for businesses to &lt;strong&gt;&lt;em&gt;invest&lt;/em&gt;&lt;/strong&gt; in individuals with backgrounds in analytics.&lt;/p&gt;

&lt;p&gt;But, why?&lt;/p&gt;

&lt;h4 id=&quot;businesses-are-gaining-competitive-advantages-through-analytics&quot;&gt;Businesses are gaining competitive advantages through analytics&lt;/h4&gt;

&lt;p&gt;Businesses are yielding results through analytics. Here’s a few areas that businesses have identified as needs courtesy of &lt;a href=&quot;https://cisonline.bu.edu/news-resources/why-business-intelligence-is-key-for-competitive-advantage/&quot;&gt;Boston University&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Data Management:&lt;/em&gt;&lt;/strong&gt; Data growth is exponential, and analytics projects are becoming the norm.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Better Decisions, Faster:&lt;/em&gt;&lt;/strong&gt; Dealing with slow information impedes management’s ability to make decisions versus competition.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Predictive Analytics:&lt;/em&gt;&lt;/strong&gt; Foresight is the ultimate competitive advantage. Being able to spot trends before competition is a huge advantage.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;Optimizing Revenue &amp;amp; Cost:&lt;/em&gt;&lt;/strong&gt; What company wouldn’t want to increase revenue while reducing cost? Analytics enables organizations to have this win-win scenario become reality.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Why should you care?&lt;/p&gt;

&lt;h4 id=&quot;data-driven-mbas-are-perfect-for-the-job&quot;&gt;Data-Driven MBAs are Perfect for the Job&lt;/h4&gt;

&lt;p&gt;How do you get your boss to make a strategic decision? &lt;strong&gt;&lt;em&gt;Data!&lt;/em&gt;&lt;/strong&gt; Of course I’m oversimplifying. It’s not only sufficient to have data, but you need to communicate it in a down-to-earth, business-savvy way. This is where an MBA can leverage communication skills along with an understanding of analytics.&lt;/p&gt;

&lt;p&gt;A huge challenge is speaking stats to non-quantitative business professionals (NQBP). NQBPs know competitive dynamics, live for SWOT analyses, and love to present on &lt;em&gt;[insert business matrix of the day]&lt;/em&gt;. While these are very important skills to have, the current business environment requires businesses to not only view strategy from traditional competitive frameworks (e.g. Porter’s Five Forces), but also to leverage the massive datasets these companies have built over years of tracking sales, operations, and customers.&lt;/p&gt;

&lt;p&gt;MBAs are great at analyzing and communicating. The life of a business professional revolves around meetings, presentations, and reports. By adding data science to your toolbox, you can bring an extra ability to communicate complex subjects in understandable ways to others in the organization that may not be as quantitative. Also, you can help team up with the quants to lend on each other’s natural abilities.&lt;/p&gt;

&lt;p&gt;Ok, so what can you do with analytics?&lt;/p&gt;

&lt;h2 id=&quot;application-examples&quot;&gt;Application Examples:&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;Alex Jones in his post entitled, &lt;em&gt;&lt;a href=&quot;https://www.linkedin.com/pulse/20140625043146-111366377-data-science-bridging-the-business-it-gap&quot;&gt;“Data Science: Bridging the Business &amp;amp; IT Gap”&lt;/a&gt;&lt;/em&gt; developed a basic framework for business problems:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://media.licdn.com/mpr/mpr/shrinknp_800_800/p/5/005/06d/039/10c2a43.jpg&quot; alt=&quot;Business Problem Framework&quot; /&gt;
&amp;lt;p class=&quot;text-center date&quot;&amp;gt;Source: &lt;a href=&quot;https://www.linkedin.com/pulse/20140625043146-111366377-data-science-bridging-the-business-it-gap&quot;&gt;Data Science: Bridging the Business &amp;amp; IT Gap&lt;/a&gt;&amp;lt;/p&amp;gt;&lt;/p&gt;

&lt;p&gt;Using the business problem framework, we can focus on a few key areas in the &lt;strong&gt;&lt;em&gt;Market&lt;/em&gt;&lt;/strong&gt; section that can have an immediate impact on sales. This is by no means an exhaustive list, but rather a few tangible examples to get you thinking.&lt;/p&gt;

&lt;h4 id=&quot;customers&quot;&gt;Customers:&lt;/h4&gt;

&lt;p&gt;The lifeblood of a business is sales, which are derived from… Customers! Analyzing customer trends is a perfect application for data science. Most organizations have customer specific sales data that tracks purchase orders. This is typically in an ERP database. The data can be parsed by features and analyzed via regression or clustering to identify deep trends.&lt;/p&gt;

&lt;p&gt;Some organizations even have databases tracking requests versus purchases, which can further help in understanding. This is typically available in a CRM database. The data can be analyzed to determine what factors correlate to a purchase. The information can be used understanding customer triggers, prioritizing which requests to work on, etc.&lt;/p&gt;

&lt;h4 id=&quot;products-and-services&quot;&gt;Products (and Services):&lt;/h4&gt;

&lt;p&gt;Products and services are essential to the business. Without the exchange or goods and services, cash does not flow into the organization. What products do your customers care about? Can you recommend another product based on the information you have available about the customer? The short answer may be yes with the help of recommender systems.&lt;/p&gt;

&lt;h4 id=&quot;promotion&quot;&gt;Promotion:&lt;/h4&gt;

&lt;p&gt;What promotional channels have the biggest impact? Are there interaction effects between channels (meaning does spending on multiple channels have a greater/lesser effect than the sum of its parts)? The answers to these questions can be answered by Marketing Mix Modeling, a technique that uses analytics to forecast the impact of marketing tactics.&lt;/p&gt;

&lt;h2 id=&quot;additional-resources&quot;&gt;Additional Resources:&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;I hope you now understand the implication of analytics in a business and how the MBA can use this to add value by leveling up in data science. To keep the knowledge transfer going, here are a few resources:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://onlinebusiness.american.edu/blog/comparing-analytics-data-science/&quot;&gt;Comparing Analytics and Data Science&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://medium.com/@dmca/the-mba-data-science-toolkit-8-resources-to-go-from-the-spreadsheet-to-the-command-line-cbb59ea82144#.uv9d8m4bn&quot;&gt;The MBA Data Science Toolkit: 8 resources to go from the spreadsheet to the command line&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://medium.com/@dmca/seven-books-every-mba-student-needs-to-read-153f3c4a6075#.wd1fvcarl&quot;&gt;Seven Books Every MBA Student Needs to Read&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;http://www.mattdancho.com/technology/2016/04/09/A-Data-Scientists-Resources.html&quot;&gt;A Data Scientist’s Resources&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</content>
      
      <category>MBA</category>
      
      <category>CRM</category>
      
      <category>Salesforce</category>
      
      <category>Sales Data Scientist</category>
      
      <category>BI</category>
      
      <category>Marketing</category>
      
      <category>Strategy</category>
      
      
      <category>Liquid error: undefined method `gsub' for ["Business"]:Array</category>
      
    </entry>
  
    <entry>
      <title>A Data Scientist's Resources</title>
      <link href="http://www.mattdancho.com/Technology/2016/04/09/A-Data-Scientists-Resources.html" />
      <updated>2016-04-09T00:00:00-04:00</updated>
      <id>http://www.mattdancho.com/Technology/2016/04/09/A-Data-Scientists-Resources</id>
      <content type="html">&lt;p&gt;Getting up and running in data science is tough. It’s easy to get overwhelmed, and your biggest asset is time (don’t waste it). Here’s some resources to help speed you along. I’ll continually update these as I get time. Feel free to &lt;strong&gt;comment&lt;/strong&gt; or &lt;strong&gt;&lt;a href=&quot;&amp;#109;&amp;#097;&amp;#105;&amp;#108;&amp;#116;&amp;#111;:&amp;#109;&amp;#100;&amp;#097;&amp;#110;&amp;#099;&amp;#104;&amp;#111;&amp;#064;&amp;#103;&amp;#109;&amp;#097;&amp;#105;&amp;#108;&amp;#046;&amp;#099;&amp;#111;&amp;#109;&quot;&gt;email&lt;/a&gt;&lt;/strong&gt; me if I’m missing something.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;About the photo:&lt;/strong&gt;
A sextant is a device used in navigation. By measuring the angle between
the horizon and the stars, one can determine a ships course. &lt;em&gt;Data science&lt;/em&gt; can be used in much the same way.
By applying data science concepts, one can develop strategies that set the direction of an organization.&lt;/p&gt;

  &lt;p&gt;-Matt&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;data-science&quot;&gt;Data Science&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;These are the best resources I’ve found to get you up and running quickly with analysis. The resources cover both programming and statistics.&lt;/p&gt;

&lt;h4 id=&quot;free-books-from-profs-and-pros-that-know-their-stuff&quot;&gt;Free Books from Profs and Pros that Know Their Stuff:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;http://hadley.nz/&quot;&gt;Hadley Wickham’s website&lt;/a&gt; - Hadley has developed many of the most commonly used &lt;code&gt;R&lt;/code&gt; packages such as &lt;code&gt;dplyr&lt;/code&gt;, &lt;code&gt;tidyr&lt;/code&gt;, &lt;code&gt;ggplot2&lt;/code&gt;, and has several books (some free) and technical papers written on various topics.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www-bcf.usc.edu/~gareth/ISL/&quot;&gt;Introduction to Statistical Learning&lt;/a&gt; - Five stars. This is by no means an easy read, but is probably the best book I’ve read bridging the gap between statistical analysis and &lt;code&gt;R&lt;/code&gt;. The book is geared towards individuals that want to apply statistical learning to real-world problems. It spends less time on theory, and more time on the actual tools.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://statweb.stanford.edu/~tibs/ElemStatLearn/&quot;&gt;Elements of Statistical Learning&lt;/a&gt; - I have not read this one, but I imagine it as the next step in the progression from ISL. I’ll report back.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://leanpub.com/rprogramming&quot;&gt;R Programming for Data Science&lt;/a&gt; - Good book you can get for free. This is pure &lt;code&gt;R&lt;/code&gt;, whereas the others are more statistics driven. It accompanies the Coursera R Programming course on Coursera.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://leanpub.com/exdata&quot;&gt;Exploratory Data Analysis with R&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://leanpub.com/artofdatascience&quot;&gt;Art of Data Science&lt;/a&gt; - The focus is on graphology… the art of communicating data. Exploratory Data Analysis shows the &lt;code&gt;R&lt;/code&gt; programming side of data communication while the Art of Data Science focuses on the fundamentals behind data communication.&lt;/p&gt;

&lt;h4 id=&quot;courses&quot;&gt;Courses:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://lagunita.stanford.edu/&quot;&gt;Intro to Statistical Learning (Stanford)&lt;/a&gt; - Free course that accompanies the ISL book mentioned above. Uses &lt;code&gt;R&lt;/code&gt; as the language. I have not taken it yet, but it gets very good feedback. I’ll report back after I finish it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.coursera.org/learn/machine-learning&quot;&gt;Machine Learning - Coursera (Stanford)&lt;/a&gt; - Free course by professor Andrew Ng. The course uses &lt;code&gt;Octave&lt;/code&gt; as the programming language, which is the only downside in my opinion (I wish he used R!). With that said, professor Ng is the best professor I can imagine for such a course. He masterfully explains the nuts and bolts of complex topics in machine learning.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.coursera.org/specializations/jhu-data-science&quot;&gt;Data Science Specialization (John Hopkin’s University)&lt;/a&gt; - This course costs $423 as of April 9, 2016. It will set you back a bit, but the price is on the order of one credit-hour at a major institution… well worth it in my opinion. &lt;strong&gt;Update:&lt;/strong&gt; I’m getting farther into the courses, and I’d give the lectures a 5/10. The redeeming quality is the companion books that Dr. Peng has put together. Overall, I’d still say the program is worth it, but the benefit is closer than I’d like…&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.coursera.org/course/statistics&quot;&gt;Data Analysis and Statistical Inference (Duke University)&lt;/a&gt; - Free course that will certainly help with introductory statistics. Course uses &lt;code&gt;R&lt;/code&gt; as the programming language.&lt;/p&gt;

&lt;h2 id=&quot;tools-of-the-trade&quot;&gt;Tools of the Trade&lt;/h2&gt;
&lt;hr /&gt;

&lt;p&gt;You need to be part programmer if you want to process and analyze data. These are the tools that I have found most useful.&lt;/p&gt;

&lt;h4 id=&quot;r&quot;&gt;R:&lt;/h4&gt;

&lt;p&gt;A language dedicated to statistics. Comes out of the box with everything you need to begin analyzing data. The real power is in the libraries R and in the open source IDE &lt;a href=&quot;https://www.rstudio.com/products/rstudio/&quot;&gt;RStudio&lt;/a&gt;. Has a huge community supporting it - Check out &lt;a href=&quot;http://www.r-bloggers.com/&quot;&gt;R-Bloggers&lt;/a&gt; if you don’t believe me. &lt;a href=&quot;https://www.rstudio.com/resources/cheatsheets/&quot;&gt;RStudio’s cheatsheets&lt;/a&gt; help instead of remembering all the commands. The website I use for searching main packages is &lt;a href=&quot;http://www.rdocumentation.org/&quot;&gt;rdocumentation.org&lt;/a&gt;, which has package categorization and searching (a necessity given the number of R packages out there). In writing this post, I yet found another good reference website for books and tutorials to get one up and running: &lt;a href=&quot;https://r-dir.com/&quot;&gt;r-dir.com&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;python&quot;&gt;Python:&lt;/h4&gt;

&lt;p&gt;Fast, and ideal for big data applications. Also has a huge community of support and great libraries such as &lt;code&gt;matplotlib&lt;/code&gt;, &lt;code&gt;scikit-learn&lt;/code&gt;, &lt;code&gt;numpy&lt;/code&gt;, and &lt;code&gt;pandas&lt;/code&gt;. Probably one of the best IDE’s (I think it’s an IDE???) for learning is &lt;a href=&quot;http://jupyter.org/&quot;&gt;Jupyter Notebooks&lt;/a&gt;. Before you get started, I recommend checking out &lt;a href=&quot;https://www.continuum.io/downloads&quot;&gt;Anaconda’s distribution&lt;/a&gt;, which comes with many of the most widely used packages pre-installed.&lt;/p&gt;

&lt;h4 id=&quot;excel&quot;&gt;Excel:&lt;/h4&gt;

&lt;p&gt;It may not be sexy, but it’s great for visualizing and pivoting data. It has issues will larger datasets, some of which can be managed with powerpivots and powerqueries. &lt;code&gt;Excel&lt;/code&gt; integrates nicely with relational databases. A great reference for Excel with lots of good tutorials is &lt;a href=&quot;http://chandoo.org/wp/welcome/&quot;&gt;Chandoo.org&lt;/a&gt;. Chandoo is amazing, and his website is a will help you “become awesome in excel”. I use it a ton.&lt;/p&gt;

&lt;h4 id=&quot;databases-sql--ms-access--mysql&quot;&gt;Databases (SQL / MS Access / MySQL):&lt;/h4&gt;

&lt;p&gt;You need a way to collect data. Databases are the key. For those interested in &lt;code&gt;SQL&lt;/code&gt;, a free tutorial/book is &lt;a href=&quot;http://sql.learncodethehardway.org/book/&quot;&gt;Learn SQL the Hard Way&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;git--github&quot;&gt;Git &amp;amp; Github:&lt;/h4&gt;

&lt;p&gt;Version control is key, which is where &lt;code&gt;Git&lt;/code&gt; comes in. GitHub helps with the communication/collaboration aspects. And, this website is built on GitHub! You can &lt;a href=&quot;https://github.com/mdancho84/mdancho84.github.io&quot;&gt;download it here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;now-go-forth-and-learn-onward-and-upward&quot;&gt;Now go forth and learn. Onward and upward.&lt;/h2&gt;

</content>
      
      <category>Code</category>
      
      <category>R</category>
      
      <category>Python</category>
      
      <category>Excel</category>
      
      <category>SQL</category>
      
      
      <category>Liquid error: undefined method `gsub' for ["Technology"]:Array</category>
      
    </entry>
  
</feed>